Subject: [PATCH] add comment feature
---
Index: backend/application/src/main/java/com/personal/portfolio/blog/application/service/CommentAppService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/application/src/main/java/com/personal/portfolio/blog/application/service/CommentAppService.java b/backend/application/src/main/java/com/personal/portfolio/blog/application/service/CommentAppService.java
new file mode 100644
--- /dev/null	(date 1766829062206)
+++ b/backend/application/src/main/java/com/personal/portfolio/blog/application/service/CommentAppService.java	(date 1766829062206)
@@ -0,0 +1,61 @@
+package com.personal.portfolio.blog.application.service;
+
+import com.personal.portfolio.blog.application.dto.CommentDTO;
+
+import com.personal.portfolio.blog.domain.context.AdminPolicy;
+import com.personal.portfolio.blog.domain.context.CurrentUserContext;
+import com.personal.portfolio.blog.domain.model.BlogPost;
+import com.personal.portfolio.blog.domain.model.Comment;
+import com.personal.portfolio.blog.domain.repository.BlogPostRepository;
+import com.personal.portfolio.blog.domain.repository.CommentRepository;
+import com.personal.portfolio.blog.domain.service.CommentDomainService;
+import com.personal.portfolio.converter.PageResultConverter;
+import com.personal.portfolio.page.PageResult;
+
+import org.springframework.stereotype.Service;
+import org.springframework.transaction.annotation.Transactional;
+
+import io.github.linpeilie.Converter;
+import lombok.RequiredArgsConstructor;
+
+@Service
+@RequiredArgsConstructor
+public class CommentAppService {
+    private final CommentRepository commentRepository;
+    private final BlogPostRepository blogPostRepository;
+    private final CurrentUserContext currentUserContext;
+    private final AdminPolicy adminPolicy;
+    private final CommentDomainService commentDomainService;
+
+    private static final Converter converter = new Converter();
+    private static final PageResultConverter pageResultConverter = new PageResultConverter();
+
+    public PageResult<CommentDTO> listComments(Long postId, Integer page, Integer size) {
+        PageResult<Comment> commentPageResult = commentRepository.listByPostId(postId, page, size);
+        return pageResultConverter.convert(commentPageResult, CommentDTO.class);
+    }
+
+    @Transactional
+    public CommentDTO createComment(Long postId, String content) {
+        BlogPost post = blogPostRepository.findById(postId).orElseThrow(() -> new IllegalArgumentException("Post not found"));
+        Comment comment = commentDomainService.composeNewComment(post, content, currentUserContext);
+        Comment saved = commentRepository.save(comment);
+        Long count = commentRepository.countByPostId(postId);
+        post.updateCommentCount(count.intValue());
+        blogPostRepository.save(post);
+        return converter.convert(saved, CommentDTO.class);
+    }
+
+    @Transactional
+    public boolean deleteComment(Long commentId) {
+        Comment target = commentRepository.findById(commentId).orElseThrow(() -> new IllegalArgumentException("Comment not found"));
+        commentDomainService.assertCanDelete(target, currentUserContext, adminPolicy);
+        boolean ok = commentRepository.deleteById(commentId);
+        Long count = commentRepository.countByPostId(target.getPostId());
+        blogPostRepository.findById(target.getPostId()).ifPresent(post -> {
+            post.updateCommentCount(count.intValue());
+            blogPostRepository.save(post);
+        });
+        return ok;
+    }
+}
Index: backend/startup/src/test/java/com/personal/portfolio/CommentDomainServiceTests.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/startup/src/test/java/com/personal/portfolio/CommentDomainServiceTests.java b/backend/startup/src/test/java/com/personal/portfolio/CommentDomainServiceTests.java
new file mode 100644
--- /dev/null	(date 1766829062207)
+++ b/backend/startup/src/test/java/com/personal/portfolio/CommentDomainServiceTests.java	(date 1766829062207)
@@ -0,0 +1,96 @@
+package com.personal.portfolio;
+
+import com.personal.portfolio.blog.domain.context.AdminPolicy;
+import com.personal.portfolio.blog.domain.context.CurrentUserContext;
+import com.personal.portfolio.blog.domain.model.BlogPost;
+import com.personal.portfolio.blog.domain.model.Comment;
+import com.personal.portfolio.blog.domain.service.CommentDomainService;
+import org.junit.jupiter.api.Assertions;
+import org.junit.jupiter.api.Test;
+
+class CommentDomainServiceTests {
+    private final CommentDomainService service = new CommentDomainService();
+
+    private static class StubUserCtx implements CurrentUserContext {
+        private final Long id;
+        private final String name;
+        StubUserCtx(Long id, String name) { this.id = id; this.name = name; }
+        public Long getCurrentUserId() { return id; }
+        public String getCurrentUsername() { return name; }
+        public boolean isAuthenticated() { return id != null; }
+        public String getCurrentLanguage() { return null; }
+        public String getCurrentHost() { return null; }
+    }
+
+    private static class StubAdminPolicy implements AdminPolicy {
+        private final String adminName;
+        StubAdminPolicy(String adminName) { this.adminName = adminName; }
+        public boolean isAdminUsername(String username) { return adminName != null && adminName.equals(username); }
+        public boolean isAdminGithubId(String githubId) { return false; }
+    }
+
+    @Test
+    void createCommentFailsWhenUnauthenticated() {
+        BlogPost post = new BlogPost();
+        post.setId(1L);
+        post.setIsPublished(true);
+        Assertions.assertThrows(IllegalStateException.class, () ->
+            service.composeNewComment(post, "hello", new StubUserCtx(null, null))
+        );
+    }
+
+    @Test
+    void createCommentFailsWhenUnpublished() {
+        BlogPost post = new BlogPost();
+        post.setId(1L);
+        post.setIsPublished(false);
+        Assertions.assertThrows(IllegalStateException.class, () ->
+            service.composeNewComment(post, "hello", new StubUserCtx(2L, "u"))
+        );
+    }
+
+    @Test
+    void createCommentFailsWhenInvalidContent() {
+        BlogPost post = new BlogPost();
+        post.setId(1L);
+        post.setIsPublished(true);
+        Assertions.assertThrows(IllegalArgumentException.class, () ->
+            service.composeNewComment(post, "   ", new StubUserCtx(2L, "u"))
+        );
+    }
+
+    @Test
+    void createCommentSucceedsAndNormalizesContent() {
+        BlogPost post = new BlogPost();
+        post.setId(10L);
+        post.setIsPublished(true);
+        Comment c = service.composeNewComment(post, "  abc  ", new StubUserCtx(3L, "alice"));
+        Assertions.assertEquals(10L, c.getPostId());
+        Assertions.assertEquals(3L, c.getUserId());
+        Assertions.assertEquals("alice", c.getAuthorName());
+        Assertions.assertEquals("abc", c.getContent());
+    }
+
+    @Test
+    void assertCanDeleteAllowsAdmin() {
+        Comment target = new Comment();
+        target.setUserId(100L);
+        service.assertCanDelete(target, new StubUserCtx(1L, "admin"), new StubAdminPolicy("admin"));
+    }
+
+    @Test
+    void assertCanDeleteAllowsOwner() {
+        Comment target = new Comment();
+        target.setUserId(5L);
+        service.assertCanDelete(target, new StubUserCtx(5L, "u5"), new StubAdminPolicy("admin"));
+    }
+
+    @Test
+    void assertCanDeleteRejectsOthers() {
+        Comment target = new Comment();
+        target.setUserId(5L);
+        Assertions.assertThrows(IllegalStateException.class, () ->
+            service.assertCanDelete(target, new StubUserCtx(6L, "u6"), new StubAdminPolicy("admin"))
+        );
+    }
+}
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/response/ListCommentsResponse.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/response/ListCommentsResponse.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/response/ListCommentsResponse.java
new file mode 100644
--- /dev/null	(date 1766715147356)
+++ b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/response/ListCommentsResponse.java	(date 1766715147356)
@@ -0,0 +1,17 @@
+package com.personal.portfolio.blog.interfaces.dto.response;
+
+import java.util.List;
+
+import lombok.Getter;
+import lombok.Setter;
+
+@Getter
+@Setter
+public class ListCommentsResponse {
+    private List<CommentResponse> items;
+    private Long total;
+    private Integer page;
+    private Integer size;
+    private Integer pages;
+}
+
Index: backend/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/pom.xml b/backend/pom.xml
--- a/backend/pom.xml	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/pom.xml	(date 1766806855722)
@@ -23,6 +23,7 @@
         <module>application</module>
         <module>interface</module>
         <module>startup</module>
+        <module>shared</module>
     </modules>
 
     <properties>
@@ -52,6 +53,11 @@
             <groupId>com.baomidou</groupId>
             <artifactId>mybatis-plus-jsqlparser</artifactId>
             <version>${mybatis-plus.version}</version>
+        </dependency>
+        <dependency>
+            <groupId>cn.hutool</groupId>
+            <artifactId>hutool-all</artifactId>
+            <version>5.8.25</version>
         </dependency>
     </dependencies>
     <build>
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/entity/CommentEntity.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/entity/CommentEntity.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/entity/CommentEntity.java
new file mode 100644
--- /dev/null	(date 1766715145844)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/entity/CommentEntity.java	(date 1766715145844)
@@ -0,0 +1,48 @@
+package com.personal.portfolio.blog.infrastructure.persistence.entity;
+
+import com.baomidou.mybatisplus.annotation.FieldFill;
+import com.baomidou.mybatisplus.annotation.IdType;
+import com.baomidou.mybatisplus.annotation.TableField;
+import com.baomidou.mybatisplus.annotation.TableId;
+import com.baomidou.mybatisplus.annotation.TableName;
+import com.personal.portfolio.blog.domain.model.Comment;
+
+import io.github.linpeilie.annotations.AutoMapper;
+import lombok.Getter;
+import lombok.Setter;
+
+import java.time.LocalDateTime;
+
+@Getter
+@Setter
+@TableName("comments")
+@AutoMapper(target = Comment.class)
+public class CommentEntity {
+    @TableId(type = IdType.AUTO)
+    private Long id;
+
+    @TableField("blog_post_id")
+    private Long postId;
+
+    @TableField("user_id")
+    private Long userId;
+
+    @TableField("author_name")
+    private String authorName;
+
+    @TableField("content")
+    private String content;
+
+    @TableField("parent_id")
+    private Long parentId;
+
+    @TableField(value = "created_at", fill = FieldFill.INSERT)
+    private LocalDateTime createdAt;
+
+    @TableField(value = "updated_at", fill = FieldFill.INSERT_UPDATE)
+    private LocalDateTime updatedAt;
+
+    @TableField("is_approved")
+    private Boolean isApproved;
+}
+
Index: backend/startup/src/test/java/com/personal/portfolio/CommentSecurityTests.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/startup/src/test/java/com/personal/portfolio/CommentSecurityTests.java b/backend/startup/src/test/java/com/personal/portfolio/CommentSecurityTests.java
new file mode 100644
--- /dev/null	(date 1766715147362)
+++ b/backend/startup/src/test/java/com/personal/portfolio/CommentSecurityTests.java	(date 1766715147362)
@@ -0,0 +1,97 @@
+package com.personal.portfolio;
+
+import org.junit.jupiter.api.Test;
+import org.springframework.beans.factory.annotation.Autowired;
+import org.springframework.boot.test.context.SpringBootTest;
+import org.springframework.boot.test.web.client.TestRestTemplate;
+import org.springframework.boot.test.web.server.LocalServerPort;
+import org.springframework.http.*;
+import org.springframework.test.context.TestPropertySource;
+
+import java.util.LinkedHashMap;
+import java.util.Map;
+
+import static org.assertj.core.api.Assertions.assertThat;
+
+@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
+@TestPropertySource(properties = {
+        "app.admin.username=admin"
+})
+public class CommentSecurityTests {
+
+    @LocalServerPort
+    private int port;
+
+    @Autowired
+    private TestRestTemplate restTemplate;
+
+    private String url(String path) {
+        return "http://localhost:" + port + path;
+    }
+
+    @Test
+    void comments_list_is_public() {
+        ResponseEntity<String> resp = restTemplate.getForEntity(url("/api/blog/posts/2/comments?page=1&size=10"), String.class);
+        assertThat(resp.getStatusCode().is2xxSuccessful()).isTrue();
+    }
+
+    @Test
+    void creating_comment_requires_auth_and_published_post() {
+        HttpHeaders headers = new HttpHeaders();
+        headers.setContentType(MediaType.APPLICATION_JSON);
+        String body = "{\"content\":\"Hello world\"}";
+
+        ResponseEntity<String> noAuthResp = restTemplate.exchange(url("/api/blog/posts/2/comments"), HttpMethod.POST, new HttpEntity<>(body, headers), String.class);
+        assertThat(noAuthResp.getStatusCode().is4xxClientError()).isTrue();
+
+        ResponseEntity<Map> regVisitor = restTemplate.postForEntity(url("/api/register"), Map.of("username", "cvisitor", "password", "visitorpass", "email", "cv@e.com"), Map.class);
+        assertThat(regVisitor.getStatusCode().is2xxSuccessful()).isTrue();
+        ResponseEntity<Map> loginVisitor = restTemplate.postForEntity(url("/api/login"), Map.of("username", "cvisitor", "password", "visitorpass"), Map.class);
+        assertThat(loginVisitor.getStatusCode().is2xxSuccessful()).isTrue();
+        LinkedHashMap<String, Object> visitorData = (LinkedHashMap<String, Object>) loginVisitor.getBody().get("data");
+        String visitorToken = (String) visitorData.get("token");
+
+        headers.set("Authorization", "Bearer " + visitorToken);
+        ResponseEntity<Map> okResp = restTemplate.exchange(url("/api/blog/posts/2/comments"), HttpMethod.POST, new HttpEntity<>(body, headers), Map.class);
+        assertThat(okResp.getStatusCode().is2xxSuccessful()).isTrue();
+
+        ResponseEntity<String> unpublishedResp = restTemplate.exchange(url("/api/blog/posts/1/comments"), HttpMethod.POST, new HttpEntity<>(body, headers), String.class);
+        assertThat(unpublishedResp.getStatusCode().is4xxClientError()).isTrue();
+    }
+
+    @Test
+    void delete_comment_allowed_for_admin_or_owner_only() {
+        ResponseEntity<Map> regVisitor = restTemplate.postForEntity(url("/api/register"), Map.of("username", "cdeleter", "password", "visitorpass", "email", "cd@e.com"), Map.class);
+        assertThat(regVisitor.getStatusCode().is2xxSuccessful()).isTrue();
+        ResponseEntity<Map> loginVisitor = restTemplate.postForEntity(url("/api/login"), Map.of("username", "cdeleter", "password", "visitorpass"), Map.class);
+        String visitorToken = (String) ((LinkedHashMap<String, Object>) loginVisitor.getBody().get("data")).get("token");
+
+        HttpHeaders vh = new HttpHeaders();
+        vh.setContentType(MediaType.APPLICATION_JSON);
+        vh.set("Authorization", "Bearer " + visitorToken);
+        ResponseEntity<Map> created = restTemplate.exchange(url("/api/blog/posts/2/comments"), HttpMethod.POST, new HttpEntity<>("{\"content\":\"to delete\"}", vh), Map.class);
+        assertThat(created.getStatusCode().is2xxSuccessful()).isTrue();
+        LinkedHashMap<String, Object> createdData = (LinkedHashMap<String, Object>) created.getBody().get("data");
+        Integer commentIdInt = (Integer) ((LinkedHashMap<String, Object>) createdData).get("id");
+        Long commentId = commentIdInt != null ? commentIdInt.longValue() : null;
+        assertThat(commentId).isNotNull();
+
+        ResponseEntity<Map> regOther = restTemplate.postForEntity(url("/api/register"), Map.of("username", "cother", "password", "visitorpass", "email", "co@e.com"), Map.class);
+        ResponseEntity<Map> loginOther = restTemplate.postForEntity(url("/api/login"), Map.of("username", "cother", "password", "visitorpass"), Map.class);
+        String otherToken = (String) ((LinkedHashMap<String, Object>) loginOther.getBody().get("data")).get("token");
+
+        HttpHeaders oh = new HttpHeaders();
+        oh.set("Authorization", "Bearer " + otherToken);
+        ResponseEntity<String> otherDelete = restTemplate.exchange(url("/api/comments/" + commentId), HttpMethod.DELETE, new HttpEntity<>(null, oh), String.class);
+        assertThat(otherDelete.getStatusCode().value()).isIn(401, 403);
+
+        ResponseEntity<Map> loginAdmin = restTemplate.postForEntity(url("/api/login"), Map.of("username", "admin", "password", "adminadmin"), Map.class);
+        String adminToken = (String) ((LinkedHashMap<String, Object>) loginAdmin.getBody().get("data")).get("token");
+        HttpHeaders ah = new HttpHeaders();
+        ah.set("Authorization", "Bearer " + adminToken);
+        ResponseEntity<String> adminDelete = restTemplate.exchange(url("/api/comments/" + commentId), HttpMethod.DELETE, new HttpEntity<>(null, ah), String.class);
+        assertThat(adminDelete.getStatusCode().is2xxSuccessful() || adminDelete.getStatusCode().is4xxClientError()).isTrue();
+        assertThat(adminDelete.getStatusCode().value()).isNotIn(401, 403);
+    }
+}
+
Index: backend/domain/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/domain/pom.xml b/backend/domain/pom.xml
--- a/backend/domain/pom.xml	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/domain/pom.xml	(date 1766806919329)
@@ -40,5 +40,10 @@
             <groupId>org.springframework</groupId>
             <artifactId>spring-web</artifactId>
         </dependency>
+        <dependency>
+            <groupId>com.personal.portfolio</groupId>
+            <artifactId>shared</artifactId>
+            <version>${project.version}</version>
+        </dependency>
     </dependencies>
 </project>
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/mapper/CommentMapper.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/mapper/CommentMapper.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/mapper/CommentMapper.java
new file mode 100644
--- /dev/null	(date 1766715145863)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/mapper/CommentMapper.java	(date 1766715145863)
@@ -0,0 +1,10 @@
+package com.personal.portfolio.blog.infrastructure.persistence.mapper;
+
+import com.baomidou.mybatisplus.core.mapper.BaseMapper;
+import com.personal.portfolio.blog.infrastructure.persistence.entity.CommentEntity;
+import org.apache.ibatis.annotations.Mapper;
+
+@Mapper
+public interface CommentMapper extends BaseMapper<CommentEntity> {
+}
+
Index: backend/application/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/application/pom.xml b/backend/application/pom.xml
--- a/backend/application/pom.xml	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/application/pom.xml	(date 1766806919291)
@@ -24,6 +24,11 @@
             <version>${project.version}</version>
         </dependency>
         <dependency>
+            <groupId>com.personal.portfolio</groupId>
+            <artifactId>shared</artifactId>
+            <version>${project.version}</version>
+        </dependency>
+        <dependency>
             <groupId>org.projectlombok</groupId>
             <artifactId>lombok</artifactId>
         </dependency>
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/CommentRepositoryImpl.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/CommentRepositoryImpl.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/CommentRepositoryImpl.java
new file mode 100644
--- /dev/null	(date 1766827970914)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/CommentRepositoryImpl.java	(date 1766827970914)
@@ -0,0 +1,76 @@
+package com.personal.portfolio.blog.infrastructure.persistence;
+
+import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
+import com.baomidou.mybatisplus.core.metadata.IPage;
+import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
+import com.personal.portfolio.blog.domain.model.Comment;
+import com.personal.portfolio.blog.domain.repository.CommentRepository;
+import com.personal.portfolio.blog.infrastructure.persistence.entity.CommentEntity;
+import com.personal.portfolio.blog.infrastructure.persistence.mapper.CommentMapper;
+import com.personal.portfolio.converter.PageResultConverter;
+import com.personal.portfolio.page.PageResult;
+
+import org.springframework.stereotype.Repository;
+
+import java.util.Optional;
+
+import io.github.linpeilie.Converter;
+
+@Repository
+public class CommentRepositoryImpl implements CommentRepository {
+    private final CommentMapper commentMapper;
+    private static final Converter converter = new Converter();
+    private static final PageResultConverter pageResultConverter = new PageResultConverter();
+
+    public CommentRepositoryImpl(CommentMapper commentMapper) {
+        this.commentMapper = commentMapper;
+    }
+
+    @Override
+    public PageResult<Comment> listByPostId(Long postId, Integer page, Integer size) {
+        Page<CommentEntity> pageRequest = new Page<>(page, size);
+        LambdaQueryWrapper<CommentEntity> wrapper = new LambdaQueryWrapper<>();
+        wrapper.eq(CommentEntity::getPostId, postId)
+               .eq(CommentEntity::getIsApproved, true)
+               .orderByAsc(CommentEntity::getCreatedAt);
+        IPage<CommentEntity> iPage = commentMapper.selectPage(pageRequest, wrapper);
+        return pageResultConverter.convertFromIPage(iPage, Comment.class);
+    }
+
+    @Override
+    public Comment save(Comment comment) {
+        CommentEntity entity = converter.convert(comment, CommentEntity.class);
+        if (entity.getId() == null) {
+            if (entity.getIsApproved() == null) {
+                entity.setIsApproved(true);
+            }
+            commentMapper.insert(entity);
+            comment.setId(entity.getId());
+        } else {
+            commentMapper.updateById(entity);
+        }
+        return comment;
+    }
+
+    @Override
+    public Optional<Comment> findById(Long id) {
+        CommentEntity entity = commentMapper.selectById(id);
+        if (entity == null) {
+            return Optional.empty();
+        }
+        return Optional.ofNullable(converter.convert(entity, Comment.class));
+    }
+
+    @Override
+    public boolean deleteById(Long id) {
+        return commentMapper.deleteById(id) > 0;
+    }
+
+    @Override
+    public Long countByPostId(Long postId) {
+        LambdaQueryWrapper<CommentEntity> wrapper = new LambdaQueryWrapper<>();
+        wrapper.eq(CommentEntity::getPostId, postId)
+               .eq(CommentEntity::getIsApproved, true);
+        return commentMapper.selectCount(wrapper);
+    }
+}
Index: backend/infrastructure/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/pom.xml b/backend/infrastructure/pom.xml
--- a/backend/infrastructure/pom.xml	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/infrastructure/pom.xml	(date 1766806919274)
@@ -24,6 +24,11 @@
             <version>${project.version}</version>
         </dependency>
         <dependency>
+            <groupId>com.personal.portfolio</groupId>
+            <artifactId>shared</artifactId>
+            <version>${project.version}</version>
+        </dependency>
+        <dependency>
             <groupId>org.springframework.boot</groupId>
             <artifactId>spring-boot-starter-web</artifactId>
         </dependency>
@@ -56,11 +61,6 @@
         <dependency>
             <groupId>org.springframework.boot</groupId>
             <artifactId>spring-boot-starter-oauth2-client</artifactId>
-        </dependency>
-        <!-- Hutool -->
-        <dependency>
-            <groupId>cn.hutool</groupId>
-            <artifactId>hutool-all</artifactId>
         </dependency>
     </dependencies>
 </project>
Index: backend/interface/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/interface/pom.xml b/backend/interface/pom.xml
--- a/backend/interface/pom.xml	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/interface/pom.xml	(date 1766806919257)
@@ -24,6 +24,11 @@
             <version>${project.version}</version>
         </dependency>
         <dependency>
+            <groupId>com.personal.portfolio</groupId>
+            <artifactId>shared</artifactId>
+            <version>${project.version}</version>
+        </dependency>
+        <dependency>
             <groupId>org.springframework.boot</groupId>
             <artifactId>spring-boot-starter-web</artifactId>
         </dependency>
@@ -57,11 +62,6 @@
         <dependency>
             <groupId>org.projectlombok</groupId>
             <artifactId>lombok</artifactId>
-        </dependency>
-        <!-- Hutool -->
-        <dependency>
-            <groupId>cn.hutool</groupId>
-            <artifactId>hutool-all</artifactId>
         </dependency>
         <!-- Test dependencies -->
         <dependency>
Index: backend/startup/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/startup/pom.xml b/backend/startup/pom.xml
--- a/backend/startup/pom.xml	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/startup/pom.xml	(date 1766826444301)
@@ -39,6 +39,11 @@
             <artifactId>domain</artifactId>
             <version>${project.version}</version>
         </dependency>
+        <dependency>
+            <groupId>com.personal.portfolio</groupId>
+            <artifactId>shared</artifactId>
+            <version>${project.version}</version>
+        </dependency>
         
         <!-- Spring Boot Starters -->
         <dependency>
Index: frontend/src/components/UserAvatar.jsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/frontend/src/components/UserAvatar.jsx b/frontend/src/components/UserAvatar.jsx
new file mode 100644
--- /dev/null	(date 1766832398783)
+++ b/frontend/src/components/UserAvatar.jsx	(date 1766832398783)
@@ -0,0 +1,36 @@
+import React from 'react'
+
+const sizes = {
+  xs: 'w-6 h-6 text-xs',
+  sm: 'w-8 h-8 text-sm',
+  md: 'w-10 h-10 text-base',
+  lg: 'w-12 h-12 text-lg'
+}
+
+const UserAvatar = ({ src, name, size = 'sm', showName = false }) => {
+  const initial = (name || 'U').charAt(0).toUpperCase()
+  const cls = sizes[size] || sizes.sm
+  const [failed, setFailed] = React.useState(false)
+  const useImage = src && !failed
+  return (
+    <div className="flex items-center gap-3">
+      <div className={`${cls} rounded-full border border-gray-200 overflow-hidden bg-gray-100 dark:bg-gray-700 flex items-center justify-center shrink-0`}>
+        {useImage ? (
+          <img
+            src={src}
+            alt={name || 'User'}
+            className="w-full h-full object-cover"
+            onError={() => setFailed(true)}
+          />
+        ) : (
+          <span className="font-bold text-gray-600 dark:text-gray-200">{initial}</span>
+        )}
+      </div>
+      {showName && (
+        <span className="font-semibold text-gray-900 dark:text-white">{name || 'User'}</span>
+      )}
+    </div>
+  )
+}
+
+export default UserAvatar
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java
--- a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java	(date 1766715145844)
@@ -53,6 +53,9 @@
                 // 访客只读：已发布列表与文章详情
                 .requestMatchers(HttpMethod.GET, "/api/blog/posts/published/**").permitAll()
                 .requestMatchers(HttpMethod.GET, "/api/blog/posts/*").permitAll()
+                .requestMatchers(HttpMethod.GET, "/api/blog/posts/*/comments").permitAll()
+                .requestMatchers(HttpMethod.POST, "/api/blog/posts/*/comments").authenticated()
+                .requestMatchers(HttpMethod.DELETE, "/api/comments/*").authenticated()
                 // 管理员权限：文章创建/更新/发布/删除/封面上传/查询全部
                 .requestMatchers(HttpMethod.POST, "/api/blog/posts/**").hasRole("ADMIN")
                 .requestMatchers(HttpMethod.PUT, "/api/blog/posts/**").hasRole("ADMIN")
Index: frontend/src/pages/BlogPost.jsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/frontend/src/pages/BlogPost.jsx b/frontend/src/pages/BlogPost.jsx
--- a/frontend/src/pages/BlogPost.jsx	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/frontend/src/pages/BlogPost.jsx	(date 1766832423037)
@@ -11,6 +11,8 @@
   Share2, Twitter, Facebook, Link as LinkIcon 
 } from 'lucide-react'
 import MermaidDiagram from '../components/MermaidDiagram'
+import CommentList from '../components/CommentList'
+import CommentForm from '../components/CommentForm'
 
 // Import highlight.js styles
 import 'highlight.js/styles/github-dark.css'
@@ -21,6 +23,7 @@
   const [post, setPost] = useState(null)
   const [loading, setLoading] = useState(true)
   const [error, setError] = useState(null)
+  const [commentRefreshKey, setCommentRefreshKey] = useState(0)
 
   useEffect(() => {
     const fetchPost = async () => {
@@ -207,41 +210,12 @@
               </div>
             </div>
 
-            {/* Comments Section - Admin Only */}
-            {user && user.role === 'ADMIN' && (
-              <div className="bg-white dark:bg-gray-800 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 p-8 md:p-12 transition-colors duration-300">
-                <h3 className="text-2xl font-bold text-gray-900 dark:text-white mb-8 flex items-center gap-3">
-                  <div className="bg-primary-100 dark:bg-primary-900/30 p-2 rounded-lg text-primary-600 dark:text-primary-400">
-                    <MessageSquare className="w-6 h-6" />
-                  </div>
-                  Comments
-                </h3>
-                
-                <div className="flex gap-6 mb-12">
-                  <div className="w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center font-bold text-gray-400 text-xl shrink-0">
-                    ?
-                  </div>
-                  <div className="flex-1">
-                    <textarea 
-                      className="w-full bg-gray-50 dark:bg-gray-700 border-0 p-4 rounded-xl h-32 focus:ring-2 focus:ring-primary-500 focus:bg-white dark:focus:bg-gray-600 transition-all resize-none placeholder-gray-400 dark:placeholder-gray-500 text-gray-900 dark:text-white" 
-                      placeholder="Share your thoughts..."
-                    ></textarea>
-                    <div className="mt-4 flex justify-end">
-                      <button className="px-8 py-3 bg-gray-900 dark:bg-gray-700 text-white font-bold rounded-xl hover:bg-black dark:hover:bg-gray-600 hover:shadow-lg hover:-translate-y-0.5 transition-all">
-                        Post Comment
-                      </button>
-                    </div>
-                  </div>
-                </div>
-
-                <div className="space-y-8">
-                  {/* Empty State */}
-                  <div className="text-center py-12 bg-gray-50 dark:bg-gray-700/50 rounded-2xl border border-dashed border-gray-200 dark:border-gray-600">
-                    <p className="text-gray-500 dark:text-gray-400 font-medium">No comments yet.</p>
-                  </div>
-                </div>
-              </div>
-            )}
+            <CommentForm
+              postId={post.id}
+              enabled={Boolean(user) && Boolean(post.isPublished)}
+              onPosted={() => setCommentRefreshKey((k) => k + 1)}
+            />
+            <CommentList postId={post.id} refreshKey={commentRefreshKey} />
           </main>
 
           {/* Right Sidebar (Sticky TOC) */}
@@ -251,8 +225,8 @@
               <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6 mb-6 transition-colors duration-300">
                 <h4 className="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Author</h4>
                 <div className="flex items-center gap-4">
-                  <div className="w-12 h-12 rounded-full bg-gray-200 dark:bg-gray-700 overflow-hidden">
-                    <img src="/images/default-avatar.png" alt="Author" className="w-full h-full object-cover" />
+                  <div className="w-12 h-12">
+                    <img src="/images/default-avatar.png" alt="User Avatar" className="w-12 h-12 rounded-full border border-gray-200 object-cover" />
                   </div>
                   <div>
                     <div className="font-bold text-gray-900 dark:text-white">Admin</div>
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/request/CreateCommentRequest.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/request/CreateCommentRequest.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/request/CreateCommentRequest.java
new file mode 100644
--- /dev/null	(date 1766715146812)
+++ b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/request/CreateCommentRequest.java	(date 1766715146812)
@@ -0,0 +1,11 @@
+package com.personal.portfolio.blog.interfaces.dto.request;
+
+import lombok.Getter;
+import lombok.Setter;
+
+@Getter
+@Setter
+public class CreateCommentRequest {
+    private String content;
+}
+
Index: frontend/src/pages/BlogHome.jsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/frontend/src/pages/BlogHome.jsx b/frontend/src/pages/BlogHome.jsx
--- a/frontend/src/pages/BlogHome.jsx	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/frontend/src/pages/BlogHome.jsx	(date 1766711558628)
@@ -4,7 +4,7 @@
 import { getPublishedBlogPosts } from '../services/blogService';
 import { useAuth } from '../context/AuthContext';
 import { 
-  Github, Twitter, Mail, Sparkles, 
+  Sparkles, 
   Calendar, Clock, ArrowRight, ChevronLeft, ChevronRight,
   Search, Folder, Tag, ChevronDown 
 } from 'lucide-react';
@@ -131,11 +131,6 @@
                 <p className="text-gray-600 mb-4 leading-relaxed">
                   {user?.bio || 'Full Stack Developer, loves open source and design. Recording my code, life and some whimsical ideas here.'}
                 </p>
-                <div className="flex justify-center md:justify-start gap-3">
-                  <a href={user?.html_url || "#"} target="_blank" rel="noreferrer" className="p-2 text-gray-500 hover:text-gray-900 hover:bg-gray-100 rounded-full transition"><Github className="w-5 h-5" /></a>
-                  <a href="#" className="p-2 text-gray-500 hover:text-blue-400 hover:bg-blue-50 rounded-full transition"><Twitter className="w-5 h-5" /></a>
-                  <a href={`mailto:${user?.email || ''}`} className="p-2 text-gray-500 hover:text-red-500 hover:bg-red-50 rounded-full transition"><Mail className="w-5 h-5" /></a>
-                </div>
               </div>
             </div>
           )}
Index: frontend/src/components/Navbar.jsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/frontend/src/components/Navbar.jsx b/frontend/src/components/Navbar.jsx
--- a/frontend/src/components/Navbar.jsx	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/frontend/src/components/Navbar.jsx	(date 1766832407293)
@@ -2,7 +2,8 @@
 import { Link, useNavigate } from 'react-router-dom'
 import { useAuth } from '../context/AuthContext'
 import { useTheme } from '../context/ThemeContext'
-import { Search, Moon, Sun, Menu, X, LogOut } from 'lucide-react'
+import { Moon, Sun, Menu, X, LogOut } from 'lucide-react'
+import UserAvatar from './UserAvatar'
 
 const Navbar = () => {
   const { user, logout } = useAuth()
@@ -54,12 +55,6 @@
           {/* Right Actions */}
           <div className="flex items-center gap-4">
             <button 
-              className="p-2 text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 rounded-full transition"
-              onClick={() => alert("Search functionality is not implemented yet!")}
-            >
-              <Search className="w-5 h-5" />
-            </button>
-            <button 
               onClick={toggleTheme}
               className="p-2 text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 rounded-full transition"
               title={theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode'}
@@ -69,15 +64,11 @@
             
             {user ? (
               <div className="hidden md:flex items-center gap-3 pl-2 border-l border-gray-200">
-                <img
-                  src={user.avatar_url || "/images/default-avatar.png"}
-                  alt="User Avatar"
-                  className="w-8 h-8 rounded-full border border-gray-200 object-cover"
-                  onError={(e) => {
-                    if (!e.target.src.includes('via.placeholder.com')) {
-                      e.target.src = `https://via.placeholder.com/35x35/667eea/ffffff?text=${(user.login || user.username || 'U').charAt(0).toUpperCase()}`
-                    }
-                  }}
+                <UserAvatar
+                  src={user.avatar_url}
+                  name={user.login || user.username}
+                  size="sm"
+                  showName
                 />
                 <button 
                   onClick={handleLogout}
Index: frontend/src/components/ConfirmDialog.jsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/frontend/src/components/ConfirmDialog.jsx b/frontend/src/components/ConfirmDialog.jsx
new file mode 100644
--- /dev/null	(date 1766832235239)
+++ b/frontend/src/components/ConfirmDialog.jsx	(date 1766832235239)
@@ -0,0 +1,32 @@
+import React from 'react'
+
+const ConfirmDialog = ({ open, title, message, confirmText, cancelText, onConfirm, onCancel }) => {
+  if (!open) return null
+  return (
+    <div className="fixed inset-0 z-50 flex items-center justify-center">
+      <div className="absolute inset-0 bg-black/50 backdrop-blur-sm"></div>
+      <div className="relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl border border-gray-100 dark:border-gray-700 w-full max-w-md mx-4">
+        <div className="p-6">
+          <div className="text-xl font-bold text-gray-900 dark:text-white">{title || '确认'}</div>
+          <div className="mt-3 text-gray-600 dark:text-gray-300">{message || ''}</div>
+          <div className="mt-6 flex justify-end gap-3">
+            <button
+              className="px-5 py-2.5 rounded-xl bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition"
+              onClick={onCancel}
+            >
+              {cancelText || '取消'}
+            </button>
+            <button
+              className="px-5 py-2.5 rounded-xl bg-red-600 text-white hover:bg-red-700 transition"
+              onClick={onConfirm}
+            >
+              {confirmText || '删除'}
+            </button>
+          </div>
+        </div>
+      </div>
+    </div>
+  )
+}
+
+export default ConfirmDialog
Index: backend/application/src/main/java/com/personal/portfolio/blog/application/service/BlogPostAppService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/application/src/main/java/com/personal/portfolio/blog/application/service/BlogPostAppService.java b/backend/application/src/main/java/com/personal/portfolio/blog/application/service/BlogPostAppService.java
--- a/backend/application/src/main/java/com/personal/portfolio/blog/application/service/BlogPostAppService.java	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/application/src/main/java/com/personal/portfolio/blog/application/service/BlogPostAppService.java	(date 1766827477293)
@@ -1,7 +1,7 @@
 package com.personal.portfolio.blog.application.service;
 
 import com.personal.portfolio.blog.application.dto.QueryBlogPostCommand;
-import com.personal.portfolio.blog.domain.common.PageResult;
+import com.personal.portfolio.page.PageResult;
 import com.personal.portfolio.blog.domain.model.BlogPost;
 import com.personal.portfolio.blog.domain.repository.BlogPostRepository;
 
Index: backend/shared/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/shared/pom.xml b/backend/shared/pom.xml
new file mode 100644
--- /dev/null	(date 1766827477341)
+++ b/backend/shared/pom.xml	(date 1766827477341)
@@ -0,0 +1,28 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<project xmlns="http://maven.apache.org/POM/4.0.0"
+         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
+    <modelVersion>4.0.0</modelVersion>
+    <parent>
+        <groupId>com.personal.portfolio</groupId>
+        <artifactId>backend</artifactId>
+        <version>1.0.0</version>
+    </parent>
+
+    <artifactId>shared</artifactId>
+
+    <properties>
+        <maven.compiler.source>21</maven.compiler.source>
+        <maven.compiler.target>21</maven.compiler.target>
+        <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
+    </properties>
+
+    <dependencies>
+        <dependency>
+            <groupId>org.projectlombok</groupId>
+            <artifactId>lombok</artifactId>
+            <version>1.18.30</version>
+            <scope>provided</scope>
+        </dependency>
+    </dependencies>
+</project>
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/BlogPostRepositoryImpl.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/BlogPostRepositoryImpl.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/BlogPostRepositoryImpl.java
--- a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/BlogPostRepositoryImpl.java	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/persistence/BlogPostRepositoryImpl.java	(date 1766827477234)
@@ -3,7 +3,7 @@
 import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
 import com.baomidou.mybatisplus.core.metadata.IPage;
 import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
-import com.personal.portfolio.blog.domain.common.PageResult;
+import com.personal.portfolio.page.PageResult;
 import com.personal.portfolio.blog.domain.model.BlogPost;
 import com.personal.portfolio.blog.domain.event.BlogPostCreatedEvent;
 import com.personal.portfolio.blog.domain.repository.BlogPostRepository;
Index: backend/shared/src/main/java/com/personal/portfolio/converter/PageResultConverter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/shared/src/main/java/com/personal/portfolio/converter/PageResultConverter.java b/backend/shared/src/main/java/com/personal/portfolio/converter/PageResultConverter.java
new file mode 100644
--- /dev/null	(date 1766827970899)
+++ b/backend/shared/src/main/java/com/personal/portfolio/converter/PageResultConverter.java	(date 1766827970899)
@@ -0,0 +1,58 @@
+package com.personal.portfolio.converter;
+
+import com.baomidou.mybatisplus.core.metadata.IPage;
+import com.personal.portfolio.page.PageResult;
+
+import java.util.Collections;
+import java.util.List;
+
+import io.github.linpeilie.Converter;
+
+public class PageResultConverter {
+
+    private static final Converter converter = new Converter();
+
+    /**
+     * 通用 PageResult 转换
+     */
+    public <A, B> PageResult<B> convert(PageResult<A> source, Class<B> targetClass) {
+        if (source == null) {
+            return new PageResult<>(Collections.emptyList(), 0L, 1, 10);
+        }
+
+        // 转换列表元素
+        List<B> convertedList = source.getRecords() != null && !source.getRecords().isEmpty()
+                ? converter.convert(source.getRecords(), targetClass)
+                : Collections.emptyList();
+
+        // 创建新的 PageResult（保留分页信息）
+        return PageResult.of(
+                convertedList,
+                source.getTotal(),
+                source.getPage(),
+                source.getSize()
+        );
+    }
+
+    /**
+     * 从 IPage 转换到 PageResult
+     */
+    public <E, D> PageResult<D> convertFromIPage(IPage<E> iPage, Class<D> targetClass) {
+        if (iPage == null) {
+            return new PageResult<>(Collections.emptyList(), 0L, 1, 10);
+        }
+
+        // 转换列表元素
+        List<D> convertedList = iPage.getRecords() != null && !iPage.getRecords().isEmpty()
+                ? converter.convert(iPage.getRecords(), targetClass)
+                : Collections.emptyList();
+
+        // 创建 PageResult
+        return PageResult.of(
+                convertedList,
+                iPage.getTotal(),
+                (int) iPage.getCurrent(),
+                (int) iPage.getSize()
+        );
+    }
+}
Index: frontend/src/services/commentService.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/frontend/src/services/commentService.js b/frontend/src/services/commentService.js
new file mode 100644
--- /dev/null	(date 1766715148005)
+++ b/frontend/src/services/commentService.js	(date 1766715148005)
@@ -0,0 +1,17 @@
+import api from './api'
+
+const API_BASE_PATH = '/blog/posts'
+
+export const getComments = async (postId, page = 1, size = 20) => {
+  const params = { page, size }
+  return await api.get(`${API_BASE_PATH}/${postId}/comments`, { params })
+}
+
+export const createComment = async (postId, content) => {
+  return await api.post(`${API_BASE_PATH}/${postId}/comments`, { content })
+}
+
+export const deleteComment = async (commentId) => {
+  return await api.delete(`/comments/${commentId}`)
+}
+
Index: frontend/src/components/CommentForm.jsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/frontend/src/components/CommentForm.jsx b/frontend/src/components/CommentForm.jsx
new file mode 100644
--- /dev/null	(date 1766715147353)
+++ b/frontend/src/components/CommentForm.jsx	(date 1766715147353)
@@ -0,0 +1,59 @@
+import React, { useState } from 'react'
+import { createComment } from '../services/commentService'
+import { MessageSquare } from 'lucide-react'
+
+const CommentForm = ({ postId, enabled, onPosted }) => {
+  const [content, setContent] = useState('')
+  const [submitting, setSubmitting] = useState(false)
+
+  const handleSubmit = async () => {
+    const text = content.trim()
+    if (!text) return
+    if (text.length > 1000) {
+      alert('Comment is too long')
+      return
+    }
+    try {
+      setSubmitting(true)
+      const res = await createComment(postId, text)
+      setContent('')
+      onPosted && onPosted(res)
+    } catch (e) {
+      alert(e.message || 'Failed to post comment')
+    } finally {
+      setSubmitting(false)
+    }
+  }
+
+  if (!enabled) return null
+
+  return (
+    <div className="bg-white dark:bg-gray-800 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 p-8 md:p-12 transition-colors duration-300 mb-8">
+      <h3 className="text-2xl font-bold text-gray-900 dark:text-white mb-8 flex items-center gap-3">
+        <div className="bg-primary-100 dark:bg-primary-900/30 p-2 rounded-lg text-primary-600 dark:text-primary-400">
+          <MessageSquare className="w-6 h-6" />
+        </div>
+        Add a comment
+      </h3>
+      <textarea
+        className="w-full bg-gray-50 dark:bg-gray-700 border-0 p-4 rounded-xl h-32 focus:ring-2 focus:ring-primary-500 focus:bg-white dark:focus:bg-gray-600 transition-all resize-none placeholder-gray-400 dark:placeholder-gray-500 text-gray-900 dark:text-white"
+        placeholder="Share your thoughts..."
+        value={content}
+        onChange={(e) => setContent(e.target.value)}
+        maxLength={1000}
+      />
+      <div className="mt-4 flex justify-end">
+        <button
+          className="px-8 py-3 bg-gray-900 dark:bg-gray-700 text-white font-bold rounded-xl hover:bg-black dark:hover:bg-gray-600 hover:shadow-lg hover:-translate-y-0.5 transition-all disabled:opacity-60"
+          onClick={handleSubmit}
+          disabled={submitting || !content.trim()}
+        >
+          {submitting ? 'Posting...' : 'Post Comment'}
+        </button>
+      </div>
+    </div>
+  )
+}
+
+export default CommentForm
+
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/CommentController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/CommentController.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/CommentController.java
new file mode 100644
--- /dev/null	(date 1766827970866)
+++ b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/CommentController.java	(date 1766827970866)
@@ -0,0 +1,43 @@
+package com.personal.portfolio.blog.interfaces.controller;
+
+import com.personal.portfolio.blog.application.dto.CommentDTO;
+import com.personal.portfolio.blog.application.service.CommentAppService;
+import com.personal.portfolio.blog.interfaces.dto.request.CreateCommentRequest;
+import com.personal.portfolio.blog.interfaces.dto.response.CommentResponse;
+import com.personal.portfolio.converter.PageResultConverter;
+import com.personal.portfolio.page.PageResult;
+
+import org.springframework.security.access.prepost.PreAuthorize;
+import org.springframework.web.bind.annotation.*;
+
+import io.github.linpeilie.Converter;
+import jakarta.validation.Valid;
+import lombok.RequiredArgsConstructor;
+
+@RestController
+@RequestMapping("/api")
+@RequiredArgsConstructor
+public class CommentController {
+    private final CommentAppService commentService;
+    private static final Converter converter = new Converter();
+    private static final PageResultConverter pageResultConverter = new PageResultConverter();
+
+    @GetMapping("/blog/posts/{postId}/comments")
+    public PageResult<CommentResponse> listComments(@PathVariable Long postId, @RequestParam(defaultValue = "1") Integer page, @RequestParam(defaultValue = "20") Integer size) {
+        PageResult<CommentDTO> result = commentService.listComments(postId, page, size);
+        return pageResultConverter.convert(result, CommentResponse.class);
+    }
+
+    @PostMapping("/blog/posts/{postId}/comments")
+    @PreAuthorize("isAuthenticated()")
+    public CommentResponse createComment(@PathVariable Long postId, @Valid @RequestBody CreateCommentRequest request) {
+        CommentDTO created = commentService.createComment(postId, request.getContent());
+        return converter.convert(created, CommentResponse.class);
+    }
+
+    @DeleteMapping("/comments/{id}")
+    @PreAuthorize("isAuthenticated()")
+    public void deleteComment(@PathVariable Long id) {
+        commentService.deleteComment(id);
+    }
+}
Index: frontend/src/components/CommentList.jsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/frontend/src/components/CommentList.jsx b/frontend/src/components/CommentList.jsx
new file mode 100644
--- /dev/null	(date 1766832415907)
+++ b/frontend/src/components/CommentList.jsx	(date 1766832415907)
@@ -0,0 +1,129 @@
+import React, { useEffect, useState } from 'react'
+import { getComments, deleteComment } from '../services/commentService'
+import { useAuth } from '../context/AuthContext'
+import { MessageSquare, Trash2 } from 'lucide-react'
+import ConfirmDialog from './ConfirmDialog'
+import UserAvatar from './UserAvatar'
+
+const CommentList = ({ postId, refreshKey }) => {
+  const { user } = useAuth()
+  const [items, setItems] = useState([])
+  const [loading, setLoading] = useState(false)
+  const [error, setError] = useState(null)
+  const [confirmDelete, setConfirmDelete] = useState({ open: false, id: null })
+
+  const canDelete = (comment) => {
+    if (!user) return false
+    if (user.role === 'ADMIN') return true
+    return user.id && comment.userId && String(user.id) === String(comment.userId)
+  }
+
+  const fetchComments = async () => {
+    try {
+      setLoading(true)
+      const res = await getComments(postId, 1, 100)
+      const items = (res && Array.isArray(res)) ? res : (res?.records || res?.items || [])
+      setItems(items)
+    } catch (e) {
+      setError(e.message || 'Failed to load comments')
+    } finally {
+      setLoading(false)
+    }
+  }
+
+  useEffect(() => {
+    if (postId) {
+      fetchComments()
+    }
+    // eslint-disable-next-line react-hooks/exhaustive-deps
+  }, [postId, refreshKey])
+
+  const handleDelete = async (id) => {
+    setConfirmDelete({ open: true, id })
+  }
+
+  return (
+    <div className="bg-white dark:bg-gray-800 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-700 p-8 md:p-12 transition-colors duration-300">
+      <h3 className="text-2xl font-bold text-gray-900 dark:text-white mb-8 flex items-center gap-3">
+        <div className="bg-primary-100 dark:bg-primary-900/30 p-2 rounded-lg text-primary-600 dark:text-primary-400">
+          <MessageSquare className="w-6 h-6" />
+        </div>
+        Comments
+      </h3>
+      {loading && <div className="text-gray-500 dark:text-gray-400">Loading comments...</div>}
+      {error && <div className="text-red-500">{error}</div>}
+      {!loading && items.length === 0 && (
+        <div className="text-center py-12 bg-gray-50 dark:bg-gray-700/50 rounded-2xl border border-dashed border-gray-200 dark:border-gray-600">
+          <p className="text-gray-500 dark:text-gray-400 font-medium">No comments yet.</p>
+        </div>
+      )}
+      <div className="space-y-8">
+        {items.map((c) => (
+          <div key={c.id} className="flex gap-4 items-start">
+            <UserAvatar src={c.avatarUrl} name={c.authorName} size="md" />
+            <div className="flex-1">
+              <div className="flex items-center justify-between">
+                <div className="font-semibold text-gray-900 dark:text-white">{c.authorName || 'Anonymous'}</div>
+                {canDelete(c) && (
+                  <button
+                    className="inline-flex items-center gap-1 text-red-600 hover:text-red-700"
+                    onClick={() => handleDelete(c.id)}
+                    title="Delete"
+                  >
+                    <Trash2 className="w-4 h-4" />
+                  </button>
+                )}
+              </div>
+              <div className="mt-2 text-gray-700 dark:text-gray-300 whitespace-pre-wrap break-words">
+                {c.content}
+              </div>
+              {c.createdAt && (
+                <div className="text-xs text-gray-400 mt-2">
+                  {formatDate(c.createdAt)}
+                </div>
+              )}
+            </div>
+          </div>
+        ))}
+      </div>
+      <ConfirmDialog
+        open={confirmDelete.open}
+        title="确认删除"
+        message="确定要删除该评论吗？此操作不可恢复"
+        confirmText="删除"
+        cancelText="取消"
+        onConfirm={async () => {
+          try {
+            if (!confirmDelete.id) return
+            await deleteComment(confirmDelete.id)
+            setItems(prev => prev.filter(i => i.id !== confirmDelete.id))
+          } catch (e) {
+            alert(e.message || 'Delete failed')
+          } finally {
+            setConfirmDelete({ open: false, id: null })
+          }
+        }}
+        onCancel={() => setConfirmDelete({ open: false, id: null })}
+      />
+    </div>
+  )
+}
+
+export default CommentList
+
+function formatDate(v) {
+  if (!v) return ''
+  if (typeof v === 'number') {
+    const d = new Date(v)
+    return isNaN(d.getTime()) ? String(v) : d.toLocaleString()
+  }
+  if (typeof v === 'string') {
+    if (/^\d{4}-\d{2}-\d{2}\s\d{2}:\d{2}:\d{2}$/.test(v)) {
+      return v
+    }
+    const d = new Date(v)
+    return isNaN(d.getTime()) ? v : d.toLocaleString()
+  }
+  const d = new Date(v)
+  return isNaN(d.getTime()) ? String(v) : d.toLocaleString()
+}
Index: .trae/documents/Implement Comments Feature (View, Add, Delete).md
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/.trae/documents/Implement Comments Feature (View, Add, Delete).md b/.trae/documents/Implement Comments Feature (View, Add, Delete).md
new file mode 100644
--- /dev/null	(date 1766723798815)
+++ b/.trae/documents/Implement Comments Feature (View, Add, Delete).md	(date 1766723798815)
@@ -0,0 +1,120 @@
+## Requirements Mapping
+
+* Visibility: All users (logged-in or not) can view comments on published posts.
+
+* Commenting: Only logged-in users can add comments on published posts.
+
+* Deletion: Admins can delete any comment; non-admin users can delete only their own comments.
+
+## Backend Endpoints
+
+* GET `/api/blog/posts/{postId}/comments` (public)
+
+  * Returns paginated list: `{ id, postId, userId, authorName, content, createdAt }`.
+
+* POST `/api/blog/posts/{postId}/comments` (authenticated)
+
+  * Body: `{ content }`; server derives `userId`, `authorName` from current user.
+
+  * Validates target post exists and `isPublished == true`.
+
+* DELETE `/api/comments/{id}` (authenticated)
+
+  * Allowed if current user `ROLE_ADMIN` or `comment.userId == currentUserId`.
+
+## Backend Implementation
+
+* Domain model: `Comment` (id, postId, userId, authorName, content, createdAt, parentId?)
+
+* Domain repository: `CommentRepository` with `listByPostId(postId, page)`, `create(comment)`, `deleteById(id)`.
+
+* Persistence (MyBatis-Plus):
+
+  * `CommentEntity` mapped to `comments` table (`@TableName("comments")`, fields per `schema.sql`).
+
+  * `CommentMapper` extends `BaseMapper<CommentEntity>`.
+
+  * `CommentRepositoryImpl` converts between domain and entity.
+
+* Application/service layer:
+
+  * `CommentService` enforcing business rules:
+
+    * On create: load `BlogPost` by `postId`; forbid if not published; set `userId/authorName`; persist; update `BlogPost.commentCount`.
+
+    * On delete: load comment; if admin → allow; else require `comment.userId == currentUserId`; delete; decrement `commentCount`.
+
+* Controller: `CommentController`
+
+  * Wires endpoints, validates input size (e.g., 1–2000 chars), returns DTOs.
+
+* Security configuration:
+
+  * Permit `GET /api/blog/posts/*/comments`.
+
+  * Require auth for `POST /api/blog/posts/*/comments` and `DELETE /api/comments/*`.
+
+  * Method-level guard in service/controller for owner-or-admin delete.
+
+## Data Contracts (DTOs)
+
+* `CommentResponse`: `{ id, postId, userId, authorName, content, createdAt }`.
+
+* `CreateCommentRequest`: `{ content }`.
+
+* `ListCommentsResponse`: `{ items: CommentResponse[], page, pageSize, total }`.
+
+## Frontend Integration
+
+* Services (`frontend/src/services/blogService.js` or new `commentService.js`):
+
+  * `getComments(postId)` → GET.
+
+  * `createComment(postId, content)` → POST (uses `Authorization: Bearer <token>` automatically).
+
+  * `deleteComment(commentId)` → DELETE.
+
+* UI components:
+
+  * `CommentList`: fetch and render comments under the post content; visible to all.
+
+  * `CommentForm`: render only if `user` exists and `post.isPublished === true`.
+
+  * Delete button per comment:
+
+    * Visible if `user.role === 'ADMIN'` or `user.id === comment.userId`.
+
+* Page integration: mount `CommentList` and conditional `CommentForm` on `BlogPost.jsx`.
+
+## Validation & Constraints
+
+* Content length: 1–2000 chars, trim whitespace; reject empty.
+
+* Rate limiting (optional): basic per-user cooldown (e.g., 5s) to reduce spam.
+
+* XSS safety: store raw text; render escaped on frontend; no HTML allowed in comments.
+
+## Tests
+
+* Backend unit/integration:
+
+  * Create comment succeeds only for authenticated users on published posts; fails for guests/unpublished.
+
+  * Delete: admin can delete any; visitor can delete own; visitor cannot delete others.
+
+  * List comments public endpoint returns results.
+
+* Frontend:
+
+  * `BlogPost` page shows comments for guests; hides form when logged out; shows form when logged in and published.
+
+  * Delete button visibility matches role/ownership; actions update UI state.
+
+## Rollout Notes
+
+* No schema changes if `comments` already exists; align entity fields to `schema.sql`.
+
+* Ensure CORS already permits frontend origin.
+
+* Document API in README or interface module for future maintenance.
+
Index: backend/domain/src/main/java/com/personal/portfolio/blog/domain/repository/CommentRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/domain/src/main/java/com/personal/portfolio/blog/domain/repository/CommentRepository.java b/backend/domain/src/main/java/com/personal/portfolio/blog/domain/repository/CommentRepository.java
new file mode 100644
--- /dev/null	(date 1766827970932)
+++ b/backend/domain/src/main/java/com/personal/portfolio/blog/domain/repository/CommentRepository.java	(date 1766827970932)
@@ -0,0 +1,14 @@
+package com.personal.portfolio.blog.domain.repository;
+
+import com.personal.portfolio.blog.domain.model.Comment;
+import com.personal.portfolio.page.PageResult;
+
+import java.util.Optional;
+
+public interface CommentRepository {
+    PageResult<Comment> listByPostId(Long postId, Integer page, Integer size);
+    Comment save(Comment comment);
+    Optional<Comment> findById(Long id);
+    boolean deleteById(Long id);
+    Long countByPostId(Long postId);
+}
Index: backend/domain/src/main/java/com/personal/portfolio/blog/domain/common/PageResult.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/domain/src/main/java/com/personal/portfolio/blog/domain/common/PageResult.java b/backend/shared/src/main/java/com/personal/portfolio/page/PageResult.java
rename from backend/domain/src/main/java/com/personal/portfolio/blog/domain/common/PageResult.java
rename to backend/shared/src/main/java/com/personal/portfolio/page/PageResult.java
--- a/backend/domain/src/main/java/com/personal/portfolio/blog/domain/common/PageResult.java	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/shared/src/main/java/com/personal/portfolio/page/PageResult.java	(date 1766827477273)
@@ -1,4 +1,4 @@
-package com.personal.portfolio.blog.domain.common;
+package com.personal.portfolio.page;
 
 import java.util.List;
 
Index: backend/application/src/main/java/com/personal/portfolio/blog/application/dto/CommentDTO.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/application/src/main/java/com/personal/portfolio/blog/application/dto/CommentDTO.java b/backend/application/src/main/java/com/personal/portfolio/blog/application/dto/CommentDTO.java
new file mode 100644
--- /dev/null	(date 1766731095274)
+++ b/backend/application/src/main/java/com/personal/portfolio/blog/application/dto/CommentDTO.java	(date 1766731095274)
@@ -0,0 +1,21 @@
+package com.personal.portfolio.blog.application.dto;
+
+import com.personal.portfolio.blog.domain.model.Comment;
+
+import java.time.LocalDateTime;
+
+import io.github.linpeilie.annotations.AutoMapper;
+import lombok.Data;
+
+@Data
+@AutoMapper(target = Comment.class)
+public class CommentDTO {
+    private Long id;
+    private Long postId;
+    private Long userId;
+    private String authorName;
+    private String content;
+    private Long parentId;
+    private LocalDateTime createdAt;
+    private LocalDateTime updatedAt;
+}
Index: backend/domain/src/main/java/com/personal/portfolio/blog/domain/service/CommentDomainService.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/domain/src/main/java/com/personal/portfolio/blog/domain/service/CommentDomainService.java b/backend/domain/src/main/java/com/personal/portfolio/blog/domain/service/CommentDomainService.java
new file mode 100644
--- /dev/null	(date 1766829062206)
+++ b/backend/domain/src/main/java/com/personal/portfolio/blog/domain/service/CommentDomainService.java	(date 1766829062206)
@@ -0,0 +1,45 @@
+package com.personal.portfolio.blog.domain.service;
+
+import com.personal.portfolio.blog.domain.context.AdminPolicy;
+import com.personal.portfolio.blog.domain.context.CurrentUserContext;
+import com.personal.portfolio.blog.domain.model.BlogPost;
+import com.personal.portfolio.blog.domain.model.Comment;
+
+import org.springframework.stereotype.Service;
+
+@Service
+public class CommentDomainService {
+    public Comment composeNewComment(BlogPost post, String rawContent, CurrentUserContext currentUserContext) {
+        if (currentUserContext == null || !currentUserContext.isAuthenticated()) {
+            throw new IllegalStateException("Unauthenticated");
+        }
+        if (post == null) {
+            throw new IllegalArgumentException("Post not found");
+        }
+        if (!post.isPublished()) {
+            throw new IllegalStateException("Post not published");
+        }
+        if (!Comment.isValidContent(rawContent)) {
+            throw new IllegalArgumentException("Invalid content");
+        }
+        Comment comment = new Comment();
+        comment.setPostId(post.getId());
+        comment.setUserId(currentUserContext.getCurrentUserId());
+        comment.setAuthorName(currentUserContext.getCurrentUsername());
+        comment.setContent(Comment.normalizeContent(rawContent));
+        return comment;
+    }
+
+    public void assertCanDelete(Comment target, CurrentUserContext currentUserContext, AdminPolicy adminPolicy) {
+        if (currentUserContext == null || !currentUserContext.isAuthenticated()) {
+            throw new IllegalStateException("Unauthenticated");
+        }
+        if (target == null) {
+            throw new IllegalArgumentException("Comment not found");
+        }
+        boolean isAdmin = adminPolicy != null && adminPolicy.isAdminUsername(currentUserContext.getCurrentUsername());
+        if (!isAdmin && !target.ownedBy(currentUserContext.getCurrentUserId())) {
+            throw new IllegalStateException("Forbidden");
+        }
+    }
+}
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/response/CommentResponse.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/response/CommentResponse.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/response/CommentResponse.java
new file mode 100644
--- /dev/null	(date 1766731095362)
+++ b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/dto/response/CommentResponse.java	(date 1766731095362)
@@ -0,0 +1,21 @@
+package com.personal.portfolio.blog.interfaces.dto.response;
+
+import com.personal.portfolio.blog.application.dto.CommentDTO;
+
+import java.time.LocalDateTime;
+
+import io.github.linpeilie.annotations.AutoMapper;
+import lombok.Getter;
+import lombok.Setter;
+
+@Getter
+@Setter
+@AutoMapper(target = CommentDTO.class)
+public class CommentResponse {
+    private Long id;
+    private Long postId;
+    private Long userId;
+    private String authorName;
+    private String content;
+    private LocalDateTime createdAt;
+}
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/BlogPostController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/BlogPostController.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/BlogPostController.java
--- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/BlogPostController.java	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/BlogPostController.java	(date 1766827477326)
@@ -4,7 +4,7 @@
 import com.personal.portfolio.blog.application.dto.QueryBlogPostCommand;
 import com.personal.portfolio.blog.application.service.BlogCreateAppService;
 import com.personal.portfolio.blog.application.service.BlogPostAppService;
-import com.personal.portfolio.blog.domain.common.PageResult;
+import com.personal.portfolio.page.PageResult;
 import com.personal.portfolio.blog.domain.context.CurrentUserContext;
 import com.personal.portfolio.blog.domain.model.BlogPost;
 import com.personal.portfolio.blog.interfaces.dto.request.CreateBlogPostRequest;
Index: backend/startup/src/test/java/com/personal/portfolio/CommentAppServiceTests.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/startup/src/test/java/com/personal/portfolio/CommentAppServiceTests.java b/backend/startup/src/test/java/com/personal/portfolio/CommentAppServiceTests.java
new file mode 100644
--- /dev/null	(date 1766829062206)
+++ b/backend/startup/src/test/java/com/personal/portfolio/CommentAppServiceTests.java	(date 1766829062206)
@@ -0,0 +1,87 @@
+package com.personal.portfolio;
+
+import com.personal.portfolio.blog.application.dto.CommentDTO;
+import com.personal.portfolio.blog.application.service.CommentAppService;
+import com.personal.portfolio.blog.domain.context.AdminPolicy;
+import com.personal.portfolio.blog.domain.context.CurrentUserContext;
+import com.personal.portfolio.blog.domain.model.BlogPost;
+import com.personal.portfolio.blog.domain.model.Comment;
+import com.personal.portfolio.blog.domain.repository.BlogPostRepository;
+import com.personal.portfolio.blog.domain.repository.CommentRepository;
+import org.junit.jupiter.api.Assertions;
+import org.junit.jupiter.api.Test;
+import org.mockito.ArgumentCaptor;
+import org.springframework.beans.factory.annotation.Autowired;
+import org.springframework.boot.test.context.SpringBootTest;
+import org.springframework.test.context.bean.override.mockito.MockitoBean;
+
+import java.util.Optional;
+
+import static org.mockito.Mockito.*;
+
+@SpringBootTest
+class CommentAppServiceTests {
+    @Autowired
+    private CommentAppService appService;
+
+    @MockitoBean
+    private CommentRepository commentRepository;
+    @MockitoBean
+    private BlogPostRepository blogPostRepository;
+    @MockitoBean
+    private CurrentUserContext currentUserContext;
+    @MockitoBean
+    private AdminPolicy adminPolicy;
+
+    @Test
+    void createCommentOrchestratesRepositoriesAndUpdatesCount() {
+        BlogPost post = new BlogPost();
+        post.setId(10L);
+        post.setIsPublished(true);
+        when(blogPostRepository.findById(10L)).thenReturn(Optional.of(post));
+        when(currentUserContext.isAuthenticated()).thenReturn(true);
+        when(currentUserContext.getCurrentUserId()).thenReturn(7L);
+        when(currentUserContext.getCurrentUsername()).thenReturn("bob");
+        when(commentRepository.save(any())).thenAnswer(invocation -> {
+            Comment c = invocation.getArgument(0);
+            c.setId(99L);
+            return c;
+        });
+        when(commentRepository.countByPostId(10L)).thenReturn(3L);
+
+        CommentDTO saved = appService.createComment(10L, " hi ");
+        Assertions.assertEquals(99L, saved.getId());
+        Assertions.assertEquals("hi", saved.getContent());
+        Assertions.assertEquals(7L, saved.getUserId());
+        Assertions.assertEquals("bob", saved.getAuthorName());
+
+        ArgumentCaptor<BlogPost> postCaptor = ArgumentCaptor.forClass(BlogPost.class);
+        verify(blogPostRepository).save(postCaptor.capture());
+        Assertions.assertEquals(3, postCaptor.getValue().getCommentCount());
+    }
+
+    @Test
+    void deleteCommentOrchestratesRepositoriesAndUpdatesCount() {
+        Comment target = new Comment();
+        target.setId(5L);
+        target.setUserId(7L);
+        target.setPostId(10L);
+        when(commentRepository.findById(5L)).thenReturn(Optional.of(target));
+        when(currentUserContext.isAuthenticated()).thenReturn(true);
+        when(currentUserContext.getCurrentUserId()).thenReturn(7L);
+        when(currentUserContext.getCurrentUsername()).thenReturn("bob");
+        when(adminPolicy.isAdminUsername("bob")).thenReturn(false);
+        when(commentRepository.deleteById(5L)).thenReturn(true);
+        when(commentRepository.countByPostId(10L)).thenReturn(1L);
+        BlogPost post = new BlogPost();
+        post.setId(10L);
+        post.setIsPublished(true);
+        when(blogPostRepository.findById(10L)).thenReturn(Optional.of(post));
+
+        boolean ok = appService.deleteComment(5L);
+        Assertions.assertTrue(ok);
+        ArgumentCaptor<BlogPost> postCaptor = ArgumentCaptor.forClass(BlogPost.class);
+        verify(blogPostRepository).save(postCaptor.capture());
+        Assertions.assertEquals(1, postCaptor.getValue().getCommentCount());
+    }
+}
Index: backend/domain/src/main/java/com/personal/portfolio/blog/domain/model/Comment.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/domain/src/main/java/com/personal/portfolio/blog/domain/model/Comment.java b/backend/domain/src/main/java/com/personal/portfolio/blog/domain/model/Comment.java
new file mode 100644
--- /dev/null	(date 1766716608878)
+++ b/backend/domain/src/main/java/com/personal/portfolio/blog/domain/model/Comment.java	(date 1766716608878)
@@ -0,0 +1,38 @@
+package com.personal.portfolio.blog.domain.model;
+
+import java.time.LocalDateTime;
+
+import lombok.Getter;
+import lombok.Setter;
+
+@Getter
+@Setter
+public class Comment {
+    private Long id;
+    private Long postId;
+    private Long userId;
+    private String authorName;
+    private String content;
+    private Long parentId;
+    private LocalDateTime createdAt;
+    private LocalDateTime updatedAt;
+
+    public boolean ownedBy(Long ownerId) {
+        if (ownerId == null || this.userId == null) {
+            return false;
+        }
+        return this.userId.equals(ownerId);
+    }
+
+    public static String normalizeContent(String raw) {
+        if (raw == null) return "";
+        return raw.trim();
+    }
+
+    public static boolean isValidContent(String raw) {
+        if (raw == null) return false;
+        String t = raw.trim();
+        if (t.isEmpty()) return false;
+        return t.length() <= 1000;
+    }
+}
Index: backend/domain/src/main/java/com/personal/portfolio/blog/domain/repository/BlogPostRepository.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/domain/src/main/java/com/personal/portfolio/blog/domain/repository/BlogPostRepository.java b/backend/domain/src/main/java/com/personal/portfolio/blog/domain/repository/BlogPostRepository.java
--- a/backend/domain/src/main/java/com/personal/portfolio/blog/domain/repository/BlogPostRepository.java	(revision ce83b1823e89fcefa301e854bad22238f86687aa)
+++ b/backend/domain/src/main/java/com/personal/portfolio/blog/domain/repository/BlogPostRepository.java	(date 1766827477309)
@@ -1,6 +1,6 @@
 package com.personal.portfolio.blog.domain.repository;
 
-import com.personal.portfolio.blog.domain.common.PageResult;
+import com.personal.portfolio.page.PageResult;
 import com.personal.portfolio.blog.domain.model.BlogPost;
 
 import java.util.List;
