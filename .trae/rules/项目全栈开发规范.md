# 个人博客系统全栈开发规范

## 0. 规范索引
本文件为项目核心总览规范，详细专项规范请参考：
- **技术栈详情**: [技术栈分析.md](./技术栈分析.md)
- **前端开发细节**: [项目前端开发规范.md](./项目前端开发规范.md)
- **DDD设计细节**: [代码DDD规范.md](./代码DDD规范.md)
- **充血模型指南**: [充血模型规范.md](./充血模型规范.md)

---

## 概述
本规范适用于个人博客系统的全栈开发，涵盖后端（Java + Spring Boot + DDD）、前端（React + Vite）及基础设施。所有代码贡献必须遵循此规范。

---

## 一、 核心硬性指标 (Mandatory)
以下指标为**一票否决**项，Code Review时必须严格检查：

1.  **类长度**: 单个类源码 **< 300行** (理想 < 200行)。
2.  **方法长度**: 单个方法源码 **< 30行** (理想 < 15行)。
3.  **参数数量**: 方法参数 **< 4个** (超过需封装为Command/DTO)。
4.  **圈复杂度**: 方法圈复杂度 **< 10** (超过需拆分)。
5.  **分层依赖**: 
    - 领域层 **严禁** 依赖应用层/基础设施层。
    - 界面层 **严禁** 直接访问领域层（必须通过应用层）。
6.  **充血模型**: 实体类 **必须** 包含业务行为，**严禁** 只有Getter/Setter的贫血模型。

---

## 二、 架构与目录规范

### 2.1 后端DDD分层架构
```
backend/
├── domain/                # [核心] 领域层：实体、值对象、领域服务、仓储接口
├── application/           # [协调] 应用层：应用服务、DTO、Command、Event
├── infrastructure/        # [支撑] 基础设施层：持久化、外部接口实现、配置
├── interface/             # [接入] 用户界面层：Controller、RPC接口
└── startup/               # [启动] 启动入口、全局配置
```

### 2.2 前端模块化架构
```
frontend/src/
├── components/            # 展示组件 (UI Only)
├── pages/                 # 容器组件 (State & Logic)
├── hooks/                 # 逻辑复用 (Custom Hooks)
├── services/              # API调用封装
└── context/               # 全局状态
```

---

## 三、 命名规范

### 3.1 Java后端
- **类名**: `PascalCase` (名词), 如 `BlogPost`, `OrderService`。
- **方法**: `camelCase` (动词开头), 如 `createOrder`, `findActiveUsers`。
- **测试类**: `TargetClass + Test`, 如 `OrderServiceTest`。
- **实现类**: `Interface + Impl` (仅用于基础设施层), 领域层优先使用具体含义命名。

### 3.2 React前端
- **组件文件**: `PascalCase.jsx`, 如 `ArticleList.jsx`。
- **Hooks**: `use + PascalCase`, 如 `useAuth`。
- **常量**: `UPPER_SNAKE_CASE`, 如 `MAX_COUNT`。

### 3.3 数据库
- **表名**: `snake_case`, 如 `blog_post`, `user_role`。
- **字段**: `snake_case`, 如 `created_at`, `is_deleted`。

---

## 四、 详细开发规范

### 4.1 领域层 (Domain)
- **实体 (Entity)**: 
  - 必须包含业务逻辑（如 `publish()`, `changeTitle()`）。
  - 属性私有，不直接暴露Setter，通过业务方法修改状态。
  - 维护一致性，发布领域事件。
- **值对象 (Value Object)**: 
  - 不可变 (Immutable)。
  - 包含自验证逻辑和无副作用的计算逻辑。
- **领域服务 (Domain Service)**: 
  - 仅处理跨实体的业务逻辑。
  - 无状态。

### 4.2 应用层 (Application)
- **应用服务**: 
  - **只做编排，不做业务**。
  - 方法体通常很简单：准备数据 -> 调用领域对象 -> 持久化 -> 发布事件。
  - 事务边界 (`@Transactional`)。
- **DTO**: 数据传输对象，不包含逻辑。

### 4.3 基础设施层 (Infrastructure)
- 实现领域层的Repository接口。
- 封装第三方API调用。
- 捕获底层异常并转换为业务可理解的异常（或不处理由全局处理）。

### 4.4 异常处理
- **自定义异常**: 继承 `RuntimeException`，如 `BusinessException`。
- **全局处理**: 使用 `@RestControllerAdvice` 统一返回标准JSON格式。
- **原则**: 早抛出，晚捕获（由最外层统一处理）。

---

## 五、 数据库规范

1.  **必备字段**: 
    - `id` (主键, BIGINT/Snowflake)
    - `created_at` (创建时间)
    - `updated_at` (更新时间)
    - `deleted` (逻辑删除标记, TINYINT)
2.  **索引**: 外键字段必须加索引；经常作为查询条件的字段加索引。
3.  **外键**: 生产环境通常禁用物理外键，由代码保证一致性。

---

## 六、 API设计规范 (RESTful)

- **URL**: 名词复数，kebab-case。
  - `GET /api/v1/articles`
  - `POST /api/v1/articles`
  - `GET /api/v1/articles/{id}`
- **状态码**: 
  - 200 OK: 成功
  - 201 Created: 创建成功
  - 400 Bad Request: 校验失败
  - 401 Unauthorized: 未登录
  - 403 Forbidden: 无权限
  - 404 Not Found: 资源不存在
  - 500 Internal Server Error: 系统错误

---

## 七、 测试规范

- **单元测试**: 覆盖核心业务逻辑（领域层实体、服务）。
- **Mock**: 外部依赖（DB、Redis、API）必须Mock。
- **命名**: `should_ExpectedBehavior_when_State`。

---

## 八、 AI代码生成提示词 (Prompt Template)

在请求AI生成代码时，请附带以下约束：
> "请遵循项目DDD规范：类<300行，方法<30行，参数<4个。使用充血模型，业务逻辑封装在实体中。领域层不依赖外部。React组件使用函数式+Hooks。所有命名符合规范。"
