Subject: [PATCH] 用户注册
---
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/security/JwtUtils.java
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/security/JwtUtils.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/security/JwtUtils.java
deleted file mode 100644
--- a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/security/JwtUtils.java	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ /dev/null	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
@@ -1,4 +0,0 @@
-package com.personal.portfolio.blog.infrastructure.security;
-
-public class JwtUtils {
-}
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/JwtProperties.java
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/JwtProperties.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/JwtProperties.java
deleted file mode 100644
--- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/JwtProperties.java	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ /dev/null	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
@@ -1,34 +0,0 @@
-package com.personal.portfolio.blog.interfaces.config;
-
-import lombok.Data;
-import org.springframework.boot.context.properties.ConfigurationProperties;
-import org.springframework.stereotype.Component;
-
-/**
- * JWT 配置属性
- */
-@Data
-@Component
-@ConfigurationProperties(prefix = "jwt")
-public class JwtProperties {
-    
-    /**
-     * JWT 密钥
-     */
-    private String secret = "personal-portfolio-jwt-secret-key-2025";
-    
-    /**
-     * Token 过期时间（分钟）
-     */
-    private Long expiration = 120L;
-    
-    /**
-     * Token 前缀
-     */
-    private String tokenPrefix = "Bearer ";
-    
-    /**
-     * Token 请求头名称
-     */
-    private String tokenHeader = "Authorization";
-}
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/OAuth2SuccessHandler.java
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/OAuth2SuccessHandler.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/OAuth2SuccessHandler.java
deleted file mode 100644
--- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/OAuth2SuccessHandler.java	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ /dev/null	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
@@ -1,133 +0,0 @@
-package com.personal.portfolio.blog.interfaces.config;
-
-import com.personal.portfolio.blog.interfaces.util.JwtUtil;
-import jakarta.servlet.ServletException;
-import jakarta.servlet.http.HttpServletRequest;
-import jakarta.servlet.http.HttpServletResponse;
-import lombok.RequiredArgsConstructor;
-import org.springframework.security.core.Authentication;
-import org.springframework.security.core.authority.SimpleGrantedAuthority;
-import org.springframework.security.core.context.SecurityContextHolder;
-import org.springframework.security.oauth2.core.user.OAuth2User;
-import org.springframework.security.web.authentication.AuthenticationSuccessHandler;
-import org.springframework.stereotype.Component;
-
-import java.io.IOException;
-import java.util.HashMap;
-import java.util.Map;
-import java.util.Collections;
-
-/**
- * OAuth2 登录成功处理器
- * 处理 GitHub 等 OAuth2 登录成功后的逻辑
- */
-@Component
-@RequiredArgsConstructor
-public class OAuth2SuccessHandler implements AuthenticationSuccessHandler {
-
-    private final JwtUtil jwtUtil;
-
-    @Override
-    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, 
-                                      Authentication authentication) throws IOException, ServletException {
-        
-        System.out.println("OAuth2 Success Handler called");
-        System.out.println("Authentication principal type: " + authentication.getPrincipal().getClass().getName());
-        
-        try {
-            if (authentication.getPrincipal() instanceof OAuth2User) {
-                OAuth2User oauth2User = (OAuth2User) authentication.getPrincipal();
-                
-                System.out.println("OAuth2 User attributes: " + oauth2User.getAttributes());
-                
-                // 从 OAuth2 用户信息中提取必要字段
-                String username = oauth2User.getAttribute("login");
-                String name = oauth2User.getAttribute("name");
-                String email = oauth2User.getAttribute("email");
-                String avatarUrl = oauth2User.getAttribute("avatar_url");
-                
-                System.out.println("Extracted user info - username: " + username + ", name: " + name + ", email: " + email);
-                
-                // 使用 GitHub ID 作为用户ID，如果没有则使用 username 的哈希值
-                Long userId = null;
-                Object idAttribute = oauth2User.getAttribute("id");
-                if (idAttribute instanceof Integer) {
-                    userId = ((Integer) idAttribute).longValue();
-                } else if (idAttribute instanceof Long) {
-                    userId = (Long) idAttribute;
-                } else if (idAttribute != null) {
-                    // 尝试转换为Long
-                    try {
-                        userId = Long.valueOf(idAttribute.toString());
-                    } catch (NumberFormatException e) {
-                        System.err.println("Failed to parse user ID: " + idAttribute);
-                    }
-                }
-                
-                if (userId == null) {
-                    userId = (long) Math.abs(username.hashCode());
-                }
-                
-                System.out.println("User ID: " + userId);
-                
-                // 生成 JWT Token
-                String token = jwtUtil.generateToken(username, userId);
-                System.out.println("Generated JWT Token: " + token);
-                
-                // 确保用户名不为空
-                if (username == null || username.trim().isEmpty()) {
-                    throw new IllegalArgumentException("GitHub用户名不能为空");
-                }
-                
-                // 构建用户信息，确保所有字段都有值
-                Map<String, Object> userInfo = new HashMap<>();
-                userInfo.put("id", userId != null ? userId : 0L);
-                userInfo.put("username", username != null ? username : "github_user");
-                userInfo.put("login", username != null ? username : "github_user");
-                userInfo.put("name", name != null ? name : username);
-                userInfo.put("email", email != null ? email : "");
-                userInfo.put("avatar_url", avatarUrl != null ? avatarUrl : "");
-                userInfo.put("displayName", name != null ? name : username);
-                
-                // 构建响应数据
-                Map<String, Object> responseData = new HashMap<>();
-                responseData.put("success", true);
-                responseData.put("message", "GitHub 登录成功");
-                responseData.put("token", token);
-                responseData.put("user", userInfo);
-                
-                System.out.println("Final user info: " + userInfo);
-                
-                // 重定向到前端 OAuth2 成功页面，携带 Token 和用户信息
-                try {
-                    String userInfoJson = new com.fasterxml.jackson.databind.ObjectMapper().writeValueAsString(userInfo);
-                    String redirectUrl = String.format(
-                        "http://localhost:3001/oauth2/success?token=%s&user=%s",
-                        java.net.URLEncoder.encode(token, "UTF-8"),
-                        java.net.URLEncoder.encode(userInfoJson, "UTF-8")
-                    );
-                    
-                    System.out.println("Redirecting to: " + redirectUrl);
-                    response.sendRedirect(redirectUrl);
-                } catch (Exception jsonError) {
-                    System.err.println("JSON encoding error: " + jsonError.getMessage());
-                    // 使用更简单的重定向作为备用方案
-                    String redirectUrl = String.format(
-                        "http://localhost:3001/oauth2/success?token=%s",
-                        java.net.URLEncoder.encode(token, "UTF-8")
-                    );
-                    response.sendRedirect(redirectUrl);
-                }
-            } else {
-                // 如果不是 OAuth2 用户，重定向到主页
-                System.out.println("Not an OAuth2 user, redirecting to home");
-                response.sendRedirect("http://localhost:3001/home");
-            }
-        } catch (Exception e) {
-            System.err.println("Error in OAuth2 success handler: " + e.getMessage());
-            e.printStackTrace();
-            // 发生错误时重定向到登录页面
-            response.sendRedirect("http://localhost:3001/login?error=oauth2_failed");
-        }
-    }
-}
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/SecurityConfig.java
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/SecurityConfig.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/SecurityConfig.java
deleted file mode 100644
--- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/SecurityConfig.java	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ /dev/null	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
@@ -1,104 +0,0 @@
-package com.personal.portfolio.blog.interfaces.config;
-
-import com.personal.portfolio.blog.interfaces.filter.JwtAuthenticationFilter;
-import lombok.RequiredArgsConstructor;
-import org.springframework.context.annotation.Bean;
-import org.springframework.context.annotation.Configuration;
-import org.springframework.security.config.annotation.web.builders.HttpSecurity;
-import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
-import org.springframework.security.config.http.SessionCreationPolicy;
-import org.springframework.security.web.SecurityFilterChain;
-import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
-
-import jakarta.servlet.http.Cookie;
-
-/**
- * Spring Security 配置类
- */
-@Configuration
-@EnableWebSecurity
-@RequiredArgsConstructor
-public class SecurityConfig {
-
-    private final JwtAuthenticationFilter jwtAuthenticationFilter;
-    private final OAuth2SuccessHandler oauth2SuccessHandler;
-
-    @Bean
-    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
-        http
-            // 配置 CORS
-            .cors(cors -> cors.configurationSource(request -> {
-                org.springframework.web.cors.CorsConfiguration corsConfiguration = new org.springframework.web.cors.CorsConfiguration();
-                corsConfiguration.setAllowedOriginPatterns(java.util.Arrays.asList("http://localhost:3000", "http://localhost:3001", "http://localhost:3002"));
-                corsConfiguration.setAllowedMethods(java.util.Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS"));
-                corsConfiguration.setAllowedHeaders(java.util.Arrays.asList("*"));
-                corsConfiguration.setAllowCredentials(true);
-                return corsConfiguration;
-            }))
-            // 配置会话管理为有状态（OAuth2 需要会话）
-            .sessionManagement(session -> session
-                .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)
-            )
-            .authorizeHttpRequests(authorize -> authorize
-                // 允许公开访问的端点
-                .requestMatchers("/", "/login", "/login/oauth2/**", "/oauth2/**", "/blog/**", "/h2-console/**", 
-                               "/api/user/profile", "/api/logout", "/api/register", "/api/login", 
-                               "/api/check-username", "/api/check-email", "/user/profile").permitAll()
-                // 其他请求需要认证
-                .anyRequest().authenticated()
-            )
-            // 禁用表单登录（使用 JWT），但保留 OAuth2 登录
-            .formLogin(form -> form.disable())
-            .oauth2Login(oauth2 -> oauth2
-                .loginPage("/login")
-                .successHandler(oauth2SuccessHandler)
-                .failureUrl("http://localhost:3001/login?error=true")
-            )
-            .logout(logout -> logout
-                .logoutUrl("/api/logout")
-                .logoutSuccessUrl("http://localhost:3001/")
-                .invalidateHttpSession(true)
-                .clearAuthentication(true)
-                .deleteCookies("JSESSIONID", "grafana_session", "grafana_session_expiry")
-                .addLogoutHandler((request, response, authentication) -> {
-                    Cookie[] cookies = request.getCookies();
-                    if (cookies != null) {
-                        for (Cookie cookie : cookies) {
-                            if (cookie.getName().equals("JSESSIONID")) {
-                                // 清除 Path=/ 的 JSESSIONID
-                                Cookie clearCookieRoot = new Cookie("JSESSIONID", "");
-                                clearCookieRoot.setPath("/");
-                                clearCookieRoot.setMaxAge(0);
-                                clearCookieRoot.setHttpOnly(cookie.isHttpOnly());
-                                response.addCookie(clearCookieRoot);
-
-                                // 清除 Path=/api 的 JSESSIONID
-                                Cookie clearCookieApi = new Cookie("JSESSIONID", "");
-                                clearCookieApi.setPath("/api");
-                                clearCookieApi.setMaxAge(0);
-                                clearCookieApi.setHttpOnly(cookie.isHttpOnly());
-                                response.addCookie(clearCookieApi);
-                            }
-                            if (cookie.getName().equals("grafana_session") || cookie.getName().equals("grafana_session_expiry")) {
-                                Cookie clearCookie = new Cookie(cookie.getName(), "");
-                                clearCookie.setPath("/");
-                                clearCookie.setMaxAge(0);
-                                clearCookie.setHttpOnly(cookie.isHttpOnly());
-                                response.addCookie(clearCookie);
-                            }
-                        }
-                    }
-                })
-                .permitAll()
-            )
-            // 禁用CSRF保护以便于开发（生产环境应该启用）
-            .csrf().disable()
-            // 允许H2控制台访问
-            .headers().frameOptions().disable();
-
-        // 添加 JWT 认证过滤器
-        http.addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);
-
-        return http.build();
-    }
-}
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/filter/JwtAuthenticationFilter.java
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/filter/JwtAuthenticationFilter.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/filter/JwtAuthenticationFilter.java
deleted file mode 100644
--- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/filter/JwtAuthenticationFilter.java	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ /dev/null	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
@@ -1,75 +0,0 @@
-package com.personal.portfolio.blog.interfaces.filter;
-
-import com.personal.portfolio.blog.interfaces.config.JwtProperties;
-import com.personal.portfolio.blog.interfaces.util.JwtUtil;
-import jakarta.servlet.FilterChain;
-import jakarta.servlet.ServletException;
-import jakarta.servlet.http.HttpServletRequest;
-import jakarta.servlet.http.HttpServletResponse;
-import lombok.RequiredArgsConstructor;
-import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
-import org.springframework.security.core.authority.SimpleGrantedAuthority;
-import org.springframework.security.core.context.SecurityContextHolder;
-import org.springframework.stereotype.Component;
-import org.springframework.web.filter.OncePerRequestFilter;
-
-import java.io.IOException;
-import java.util.Collections;
-
-/**
- * JWT 认证过滤器
- */
-@Component
-@RequiredArgsConstructor
-public class JwtAuthenticationFilter extends OncePerRequestFilter {
-
-    private final JwtUtil jwtUtil;
-    private final JwtProperties jwtProperties;
-
-    @Override
-    protected void doFilterInternal(HttpServletRequest request, 
-                                  HttpServletResponse response, 
-                                  FilterChain filterChain) throws ServletException, IOException {
-        
-        // 获取请求头中的 Token
-        String token = resolveToken(request);
-        
-        if (token != null && jwtUtil.validateToken(token)) {
-            // Token 有效，设置认证信息
-            String username = jwtUtil.getUsernameFromToken(token);
-            Long userId = jwtUtil.getUserIdFromToken(token);
-            
-            if (username != null && userId != null) {
-                // 创建认证令牌
-                UsernamePasswordAuthenticationToken authentication = 
-                    new UsernamePasswordAuthenticationToken(
-                        username, 
-                        null, 
-                        Collections.singletonList(new SimpleGrantedAuthority("ROLE_USER"))
-                    );
-                
-                // 设置认证信息到 SecurityContext
-                SecurityContextHolder.getContext().setAuthentication(authentication);
-                
-                // 将用户ID设置到请求属性中，方便后续使用
-                request.setAttribute("userId", userId);
-            }
-        }
-        
-        filterChain.doFilter(request, response);
-    }
-
-    /**
-     * 从请求头中解析 Token
-     *
-     * @param request HTTP 请求
-     * @return Token 字符串
-     */
-    private String resolveToken(HttpServletRequest request) {
-        String bearerToken = request.getHeader(jwtProperties.getTokenHeader());
-        if (bearerToken != null && bearerToken.startsWith(jwtProperties.getTokenPrefix())) {
-            return bearerToken.substring(jwtProperties.getTokenPrefix().length());
-        }
-        return null;
-    }
-}
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/util/JwtUtil.java
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/util/JwtUtil.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/util/JwtUtil.java
deleted file mode 100644
--- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/util/JwtUtil.java	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ /dev/null	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
@@ -1,134 +0,0 @@
-package com.personal.portfolio.blog.interfaces.util;
-
-import cn.hutool.jwt.JWT;
-import cn.hutool.jwt.JWTUtil;
-import cn.hutool.jwt.JWTValidator;
-import cn.hutool.jwt.signers.JWTSigner;
-import cn.hutool.jwt.signers.JWTSignerUtil;
-import com.personal.portfolio.blog.interfaces.config.JwtProperties;
-import lombok.RequiredArgsConstructor;
-import org.springframework.stereotype.Component;
-
-import java.nio.charset.StandardCharsets;
-import java.util.Date;
-import java.util.HashMap;
-import java.util.Map;
-
-/**
- * JWT 工具类
- */
-@Component
-@RequiredArgsConstructor
-public class JwtUtil {
-
-    private final JwtProperties jwtProperties;
-
-    /**
-     * 生成 JWT Token
-     *
-     * @param username 用户名
-     * @param userId   用户ID
-     * @return JWT Token
-     */
-    public String generateToken(String username, Long userId) {
-        Map<String, Object> payload = new HashMap<>();
-        payload.put("username", username);
-        payload.put("userId", userId);
-        payload.put("issuedAt", new Date());
-        payload.put("expiresAt", new Date(System.currentTimeMillis() + jwtProperties.getExpiration() * 60 * 1000));
-
-        JWTSigner signer = JWTSignerUtil.hs256(jwtProperties.getSecret().getBytes(StandardCharsets.UTF_8));
-        return JWTUtil.createToken(payload, signer);
-    }
-
-    /**
-     * 验证 JWT Token
-     *
-     * @param token JWT Token
-     * @return 是否有效
-     */
-    public boolean validateToken(String token) {
-        try {
-            JWTSigner signer = JWTSignerUtil.hs256(jwtProperties.getSecret().getBytes(StandardCharsets.UTF_8));
-            JWT jwt = JWTUtil.parseToken(token);
-            
-            // 验证签名
-            if (!jwt.setSigner(signer).verify()) {
-                return false;
-            }
-            
-            // 验证过期时间
-            JWTValidator.of(jwt).validateDate();
-            return true;
-        } catch (Exception e) {
-            return false;
-        }
-    }
-
-    /**
-     * 从 Token 中获取用户名
-     *
-     * @param token JWT Token
-     * @return 用户名
-     */
-    public String getUsernameFromToken(String token) {
-        try {
-            JWT jwt = JWTUtil.parseToken(token);
-            return jwt.getPayload("username").toString();
-        } catch (Exception e) {
-            return null;
-        }
-    }
-
-    /**
-     * 从 Token 中获取用户ID
-     *
-     * @param token JWT Token
-     * @return 用户ID
-     */
-    public Long getUserIdFromToken(String token) {
-        try {
-            JWT jwt = JWTUtil.parseToken(token);
-            return Long.valueOf(jwt.getPayload("userId").toString());
-        } catch (Exception e) {
-            return null;
-        }
-    }
-
-    /**
-     * 检查 Token 是否即将过期（在指定分钟内）
-     *
-     * @param token JWT Token
-     * @param minutes 分钟数
-     * @return 是否即将过期
-     */
-    public boolean isTokenExpiringSoon(String token, int minutes) {
-        try {
-            JWT jwt = JWTUtil.parseToken(token);
-            Date expiresAt = (Date) jwt.getPayload("expiresAt");
-            long timeUntilExpiry = expiresAt.getTime() - System.currentTimeMillis();
-            return timeUntilExpiry <= minutes * 60 * 1000;
-        } catch (Exception e) {
-            return true;
-        }
-    }
-
-    /**
-     * 刷新 Token
-     *
-     * @param token 原 Token
-     * @return 新 Token
-     */
-    public String refreshToken(String token) {
-        try {
-            String username = getUsernameFromToken(token);
-            Long userId = getUserIdFromToken(token);
-            if (username != null && userId != null) {
-                return generateToken(username, userId);
-            }
-            return null;
-        } catch (Exception e) {
-            return null;
-        }
-    }
-}
Index: Changes.patch
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/Changes.patch b/Changes.patch
deleted file mode 100644
--- a/Changes.patch	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ /dev/null	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
@@ -1,359 +0,0 @@
-Subject: [PATCH] 用户注册
----
-Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/security/JwtUtils.java
-===================================================================
-diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/security/JwtUtils.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/security/JwtUtils.java
-deleted file mode 100644
---- a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/security/JwtUtils.java	(revision cb31a17aeea37a7932663507c2effafe981de07b)
-+++ /dev/null	(revision cb31a17aeea37a7932663507c2effafe981de07b)
-@@ -1,4 +0,0 @@
--package com.personal.portfolio.blog.infrastructure.security;
--
--public class JwtUtils {
--}
-Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/filter/JwtAuthenticationFilter.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/filter/JwtAuthenticationFilter.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/filter/JwtAuthenticationFilter.java
-rename from backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/filter/JwtAuthenticationFilter.java
-rename to backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/filter/JwtAuthenticationFilter.java
---- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/filter/JwtAuthenticationFilter.java	(revision cb31a17aeea37a7932663507c2effafe981de07b)
-+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/filter/JwtAuthenticationFilter.java	(date 1764594002631)
-@@ -1,7 +1,7 @@
--package com.personal.portfolio.blog.interfaces.filter;
-+package com.personal.portfolio.blog.infrastructure.filter;
- 
--import com.personal.portfolio.blog.interfaces.config.JwtProperties;
--import com.personal.portfolio.blog.interfaces.util.JwtUtil;
-+import com.personal.portfolio.blog.infrastructure.config.JwtProperties;
-+import com.personal.portfolio.blog.infrastructure.util.JwtUtil;
- import jakarta.servlet.FilterChain;
- import jakarta.servlet.ServletException;
- import jakarta.servlet.http.HttpServletRequest;
-Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/util/JwtUtil.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/util/JwtUtil.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/JwtUtil.java
-rename from backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/util/JwtUtil.java
-rename to backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/JwtUtil.java
---- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/util/JwtUtil.java	(revision cb31a17aeea37a7932663507c2effafe981de07b)
-+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/JwtUtil.java	(date 1764594101989)
-@@ -1,11 +1,12 @@
--package com.personal.portfolio.blog.interfaces.util;
-+package com.personal.portfolio.blog.infrastructure.util;
-+
-+import com.personal.portfolio.blog.infrastructure.config.JwtProperties;
- 
- import cn.hutool.jwt.JWT;
- import cn.hutool.jwt.JWTUtil;
- import cn.hutool.jwt.JWTValidator;
- import cn.hutool.jwt.signers.JWTSigner;
- import cn.hutool.jwt.signers.JWTSignerUtil;
--import com.personal.portfolio.blog.interfaces.config.JwtProperties;
- import lombok.RequiredArgsConstructor;
- import org.springframework.stereotype.Component;
- 
-Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/interceptor/ProfileInterceptor.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/interceptor/ProfileInterceptor.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/interceptor/ProfileInterceptor.java
-new file mode 100644
---- /dev/null	(date 1764593186148)
-+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/interceptor/ProfileInterceptor.java	(date 1764593186148)
-@@ -0,0 +1,43 @@
-+package com.personal.portfolio.blog.infrastructure.interceptor;
-+
-+import static com.personal.portfolio.blog.infrastructure.context.ContextConstants.*;
-+
-+import com.personal.portfolio.blog.infrastructure.util.ProfileUtil;
-+
-+import org.springframework.stereotype.Component;
-+import org.springframework.web.servlet.HandlerInterceptor;
-+
-+import jakarta.servlet.http.HttpServletRequest;
-+import jakarta.servlet.http.HttpServletResponse;
-+import lombok.extern.slf4j.Slf4j;
-+
-+@Component
-+@Slf4j
-+public class ProfileInterceptor implements HandlerInterceptor {
-+
-+    @Override
-+    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
-+        String username = getUserName(request);
-+        String host = getRemoteHost(request);
-+        log.info("request header username:{}", username);
-+        ProfileUtil.put(USERNAME, username);
-+        ProfileUtil.put(HOST, host);
-+        return true;
-+    }
-+
-+    /* Started by AICoder, pid:8e44ay2f813d9d714687095970254d0372c7f5b7 */
-+    private String getRemoteHost(HttpServletRequest request) {
-+        return request.getRemoteHost();
-+    }
-+
-+    private String getUserName(HttpServletRequest request) {
-+        return request.getHeader("username");
-+    }
-+    /* Ended by AICoder, pid:8e44ay2f813d9d714687095970254d0372c7f5b7 */
-+
-+    @Override
-+    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)  {
-+        ProfileUtil.remove();
-+    }
-+
-+}
-Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/JwtProperties.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/JwtProperties.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/JwtProperties.java
-rename from backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/JwtProperties.java
-rename to backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/JwtProperties.java
---- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/JwtProperties.java	(revision cb31a17aeea37a7932663507c2effafe981de07b)
-+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/JwtProperties.java	(date 1764593449836)
-@@ -1,4 +1,4 @@
--package com.personal.portfolio.blog.interfaces.config;
-+package com.personal.portfolio.blog.infrastructure.config;
- 
- import lombok.Data;
- import org.springframework.boot.context.properties.ConfigurationProperties;
-Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/OAuth2SuccessHandler.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/OAuth2SuccessHandler.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2SuccessHandler.java
-rename from backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/OAuth2SuccessHandler.java
-rename to backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2SuccessHandler.java
---- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/OAuth2SuccessHandler.java	(revision cb31a17aeea37a7932663507c2effafe981de07b)
-+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2SuccessHandler.java	(date 1764593916271)
-@@ -1,13 +1,8 @@
--package com.personal.portfolio.blog.interfaces.config;
-+package com.personal.portfolio.blog.infrastructure.config;
- 
--import com.personal.portfolio.blog.interfaces.util.JwtUtil;
--import jakarta.servlet.ServletException;
--import jakarta.servlet.http.HttpServletRequest;
--import jakarta.servlet.http.HttpServletResponse;
--import lombok.RequiredArgsConstructor;
-+import com.personal.portfolio.blog.infrastructure.util.JwtUtil;
-+
- import org.springframework.security.core.Authentication;
--import org.springframework.security.core.authority.SimpleGrantedAuthority;
--import org.springframework.security.core.context.SecurityContextHolder;
- import org.springframework.security.oauth2.core.user.OAuth2User;
- import org.springframework.security.web.authentication.AuthenticationSuccessHandler;
- import org.springframework.stereotype.Component;
-@@ -15,7 +10,11 @@
- import java.io.IOException;
- import java.util.HashMap;
- import java.util.Map;
--import java.util.Collections;
-+
-+import jakarta.servlet.ServletException;
-+import jakarta.servlet.http.HttpServletRequest;
-+import jakarta.servlet.http.HttpServletResponse;
-+import lombok.RequiredArgsConstructor;
- 
- /**
-  * OAuth2 登录成功处理器
-Index: backend/infrastructure/pom.xml
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/infrastructure/pom.xml b/backend/infrastructure/pom.xml
---- a/backend/infrastructure/pom.xml	(revision cb31a17aeea37a7932663507c2effafe981de07b)
-+++ b/backend/infrastructure/pom.xml	(date 1764594002654)
-@@ -48,5 +48,23 @@
-             <groupId>com.fasterxml.jackson.datatype</groupId>
-             <artifactId>jackson-datatype-jsr310</artifactId>
-         </dependency>
-+        <dependency>
-+            <groupId>org.springframework.boot</groupId>
-+            <artifactId>spring-boot-starter-security</artifactId>
-+        </dependency>
-+        <dependency>
-+            <groupId>com.alibaba</groupId>
-+            <artifactId>transmittable-thread-local</artifactId>
-+            <version>2.14.5</version>
-+        </dependency>
-+        <dependency>
-+            <groupId>org.springframework.boot</groupId>
-+            <artifactId>spring-boot-starter-oauth2-client</artifactId>
-+        </dependency>
-+        <!-- Hutool -->
-+        <dependency>
-+            <groupId>cn.hutool</groupId>
-+            <artifactId>hutool-all</artifactId>
-+        </dependency>
-     </dependencies>
- </project>
-Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/context/ContextConstants.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/context/ContextConstants.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/context/ContextConstants.java
-new file mode 100644
---- /dev/null	(date 1764593038435)
-+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/context/ContextConstants.java	(date 1764593038435)
-@@ -0,0 +1,8 @@
-+package com.personal.portfolio.blog.infrastructure.context;
-+
-+public class ContextConstants {
-+    public static final String USERNAME = "username";
-+    public static final String HOST = "host";
-+    public static final String LANGUAGE = "language";
-+    public static final String NULL_USER = "[empty_user]";
-+}
-Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/ProfileUtil.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/ProfileUtil.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/ProfileUtil.java
-new file mode 100644
---- /dev/null	(date 1764593038415)
-+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/ProfileUtil.java	(date 1764593038415)
-@@ -0,0 +1,61 @@
-+package com.personal.portfolio.blog.infrastructure.util;
-+
-+import static com.personal.portfolio.blog.infrastructure.context.ContextConstants.*;
-+
-+import com.alibaba.ttl.TransmittableThreadLocal;
-+
-+import java.util.HashMap;
-+import java.util.Map;
-+import java.util.Objects;
-+
-+public class ProfileUtil {
-+
-+    private static final String OPERATOR_DESCRIBE = "X-Operator-Describe";
-+
-+    private static final ThreadLocal<Map<String, String>> PROFILES;
-+
-+    static {
-+        PROFILES = new TransmittableThreadLocal<>();
-+        PROFILES.set(new HashMap<>());
-+    }
-+
-+    public ProfileUtil() {
-+    }
-+
-+    private static Map<String, String> getProfiles() {
-+        if (null == PROFILES.get()) {
-+            PROFILES.set(new HashMap<>());
-+        }
-+        return PROFILES.get();
-+    }
-+
-+    public static void put(String key, String value) {
-+        getProfiles().put(key, value);
-+    }
-+
-+    public static String get(String key) {
-+        return getProfiles().get(key);
-+    }
-+
-+    public static String getUsername() {
-+        String userId = get(USERNAME);
-+        return userId == null ? NULL_USER : userId;
-+    }
-+
-+    public static String getHost() {
-+        return get(HOST);
-+    }
-+
-+    public static String getLanguage() {
-+        return get(LANGUAGE);
-+    }
-+
-+    public static void remove() {
-+        if (Objects.nonNull(PROFILES)) {
-+            PROFILES.remove();
-+        }
-+    }
-+
-+
-+
-+}
-Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/WebMvcConfig.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/WebMvcConfig.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/WebMvcConfig.java
-new file mode 100644
---- /dev/null	(date 1764594282680)
-+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/WebMvcConfig.java	(date 1764594282680)
-@@ -0,0 +1,23 @@
-+package com.personal.portfolio.blog.infrastructure.config;
-+
-+import com.personal.portfolio.blog.infrastructure.interceptor.ProfileInterceptor;
-+
-+import org.springframework.beans.factory.annotation.Autowired;
-+import org.springframework.context.annotation.Configuration;
-+import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
-+import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
-+
-+@Configuration
-+public class WebMvcConfig implements WebMvcConfigurer {
-+
-+    @Autowired
-+    private ProfileInterceptor profileInterceptor;
-+
-+    @Override
-+    public void addInterceptors(InterceptorRegistry registry) {
-+        String patternsAll = "/**";
-+
-+        registry.addInterceptor(profileInterceptor).addPathPatterns(patternsAll);
-+
-+    }
-+}
-Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/SecurityConfig.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/SecurityConfig.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java
-rename from backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/SecurityConfig.java
-rename to backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java
---- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/config/SecurityConfig.java	(revision cb31a17aeea37a7932663507c2effafe981de07b)
-+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java	(date 1764594050633)
-@@ -1,6 +1,7 @@
--package com.personal.portfolio.blog.interfaces.config;
-+package com.personal.portfolio.blog.infrastructure.config;
- 
--import com.personal.portfolio.blog.interfaces.filter.JwtAuthenticationFilter;
-+import com.personal.portfolio.blog.infrastructure.filter.JwtAuthenticationFilter;
-+
- import lombok.RequiredArgsConstructor;
- import org.springframework.context.annotation.Bean;
- import org.springframework.context.annotation.Configuration;
-Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/AuthController.java
-IDEA additional info:
-Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
-<+>UTF-8
-===================================================================
-diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/AuthController.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/AuthController.java
---- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/AuthController.java	(revision cb31a17aeea37a7932663507c2effafe981de07b)
-+++ b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/AuthController.java	(date 1764593449937)
-@@ -6,7 +6,7 @@
- import com.personal.portfolio.blog.interfaces.dto.request.RegisterRequest;
- import com.personal.portfolio.blog.interfaces.dto.response.*;
- import com.personal.portfolio.blog.interfaces.exception.InvalidCredentialsException;
--import com.personal.portfolio.blog.interfaces.util.JwtUtil;
-+import com.personal.portfolio.blog.infrastructure.util.JwtUtil;
- import org.springframework.security.core.Authentication;
- import org.springframework.security.core.annotation.AuthenticationPrincipal;
- import org.springframework.security.core.context.SecurityContextHolder;
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/ProfileUtil.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/ProfileUtil.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/ProfileUtil.java
new file mode 100644
--- /dev/null	(date 1764667193971)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/ProfileUtil.java	(date 1764667193971)
@@ -0,0 +1,64 @@
+package com.personal.portfolio.blog.infrastructure.util;
+
+import static com.personal.portfolio.blog.infrastructure.context.ContextConstants.*;
+
+import com.alibaba.ttl.TransmittableThreadLocal;
+
+import java.util.HashMap;
+import java.util.Map;
+import java.util.Objects;
+
+public class ProfileUtil {
+
+    private static final ThreadLocal<Map<String, String>> PROFILES;
+
+    static {
+        PROFILES = new TransmittableThreadLocal<>();
+        PROFILES.set(new HashMap<>());
+    }
+
+    public ProfileUtil() {
+    }
+
+    private static Map<String, String> getProfiles() {
+        if (null == PROFILES.get()) {
+            PROFILES.set(new HashMap<>());
+        }
+        return PROFILES.get();
+    }
+
+    public static void put(String key, String value) {
+        getProfiles().put(key, value);
+    }
+
+    public static String get(String key) {
+        return getProfiles().get(key);
+    }
+
+    public static String getUsername() {
+        String userId = get(USERNAME);
+        return userId == null ? NULL_USER : userId;
+    }
+
+    public static String getUserId() {
+        String userId = get(USER_ID);
+        return userId == null ? NULL_USER_ID : userId;
+    }
+
+    public static String getHost() {
+        return get(HOST);
+    }
+
+    public static String getLanguage() {
+        return get(LANGUAGE);
+    }
+
+    public static void remove() {
+        if (Objects.nonNull(PROFILES)) {
+            PROFILES.remove();
+        }
+    }
+
+
+
+}
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/JwtUtil.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/JwtUtil.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/JwtUtil.java
new file mode 100644
--- /dev/null	(date 1764664236562)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/util/JwtUtil.java	(date 1764664236562)
@@ -0,0 +1,150 @@
+package com.personal.portfolio.blog.infrastructure.util;
+
+import com.personal.portfolio.blog.infrastructure.config.JwtProperties;
+
+import cn.hutool.jwt.JWT;
+import cn.hutool.jwt.JWTUtil;
+import cn.hutool.jwt.JWTValidator;
+import cn.hutool.jwt.signers.JWTSigner;
+import cn.hutool.jwt.signers.JWTSignerUtil;
+import jakarta.servlet.http.HttpServletRequest;
+import lombok.RequiredArgsConstructor;
+import org.springframework.stereotype.Component;
+
+import java.nio.charset.StandardCharsets;
+import java.util.Date;
+import java.util.HashMap;
+import java.util.Map;
+
+/**
+ * JWT 工具类
+ */
+@Component
+@RequiredArgsConstructor
+public class JwtUtil {
+
+    private final JwtProperties jwtProperties;
+
+    /**
+     * 生成 JWT Token
+     *
+     * @param username 用户名
+     * @param userId   用户ID
+     * @return JWT Token
+     */
+    public String generateToken(String username, Long userId) {
+        Map<String, Object> payload = new HashMap<>();
+        payload.put("username", username);
+        payload.put("userId", userId);
+        payload.put("issuedAt", new Date());
+        payload.put("expiresAt", new Date(System.currentTimeMillis() + jwtProperties.getExpiration() * 60 * 1000));
+
+        JWTSigner signer = JWTSignerUtil.hs256(jwtProperties.getSecret().getBytes(StandardCharsets.UTF_8));
+        return JWTUtil.createToken(payload, signer);
+    }
+
+    /**
+     * 验证 JWT Token
+     *
+     * @param token JWT Token
+     * @return 是否有效
+     */
+    public boolean validateToken(String token) {
+        try {
+            JWTSigner signer = JWTSignerUtil.hs256(jwtProperties.getSecret().getBytes(StandardCharsets.UTF_8));
+            JWT jwt = JWTUtil.parseToken(token);
+            
+            // 验证签名
+            if (!jwt.setSigner(signer).verify()) {
+                return false;
+            }
+            
+            // 验证过期时间
+            JWTValidator.of(jwt).validateDate();
+            return true;
+        } catch (Exception e) {
+            return false;
+        }
+    }
+
+    /**
+     * 从 Token 中获取用户名
+     *
+     * @param token JWT Token
+     * @return 用户名
+     */
+    public String getUsernameFromToken(String token) {
+        try {
+            JWT jwt = JWTUtil.parseToken(token);
+            return jwt.getPayload("username").toString();
+        } catch (Exception e) {
+            return null;
+        }
+    }
+
+    /**
+     * 从 Token 中获取用户ID
+     *
+     * @param token JWT Token
+     * @return 用户ID
+     */
+    public Long getUserIdFromToken(String token) {
+        try {
+            JWT jwt = JWTUtil.parseToken(token);
+            return Long.valueOf(jwt.getPayload("userId").toString());
+        } catch (Exception e) {
+            return null;
+        }
+    }
+
+    /**
+     * 检查 Token 是否即将过期（在指定分钟内）
+     *
+     * @param token JWT Token
+     * @param minutes 分钟数
+     * @return 是否即将过期
+     */
+    public boolean isTokenExpiringSoon(String token, int minutes) {
+        try {
+            JWT jwt = JWTUtil.parseToken(token);
+            Date expiresAt = (Date) jwt.getPayload("expiresAt");
+            long timeUntilExpiry = expiresAt.getTime() - System.currentTimeMillis();
+            return timeUntilExpiry <= minutes * 60 * 1000;
+        } catch (Exception e) {
+            return true;
+        }
+    }
+
+    /**
+     * 刷新 Token
+     *
+     * @param token 原 Token
+     * @return 新 Token
+     */
+    public String refreshToken(String token) {
+        try {
+            String username = getUsernameFromToken(token);
+            Long userId = getUserIdFromToken(token);
+            if (username != null && userId != null) {
+                return generateToken(username, userId);
+            }
+            return null;
+        } catch (Exception e) {
+            return null;
+        }
+    }
+
+    /**
+     * 从请求头中解析 Token
+     *
+     * @param request HTTP 请求
+     * @return Token 字符串
+     */
+    public String resolveToken(HttpServletRequest request) {
+        String bearerToken = request.getHeader(jwtProperties.getTokenHeader());
+        if (bearerToken != null && bearerToken.startsWith(jwtProperties.getTokenPrefix())) {
+            return bearerToken.substring(jwtProperties.getTokenPrefix().length());
+        }
+        return null;
+    }
+}
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/context/ContextConstants.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/context/ContextConstants.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/context/ContextConstants.java
new file mode 100644
--- /dev/null	(date 1764667193855)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/context/ContextConstants.java	(date 1764667193855)
@@ -0,0 +1,10 @@
+package com.personal.portfolio.blog.infrastructure.context;
+
+public class ContextConstants {
+    public static final String USERNAME = "username";
+    public static final String USER_ID = "userId";
+    public static final String HOST = "host";
+    public static final String LANGUAGE = "language";
+    public static final String NULL_USER = "[empty_user]";
+    public static final String NULL_USER_ID = "[empty_user_id]";
+}
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/interceptor/ProfileInterceptor.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/interceptor/ProfileInterceptor.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/interceptor/ProfileInterceptor.java
new file mode 100644
--- /dev/null	(date 1764746190785)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/interceptor/ProfileInterceptor.java	(date 1764746190785)
@@ -0,0 +1,48 @@
+package com.personal.portfolio.blog.infrastructure.interceptor;
+
+import static com.personal.portfolio.blog.infrastructure.context.ContextConstants.*;
+
+import com.personal.portfolio.blog.infrastructure.util.JwtUtil;
+import com.personal.portfolio.blog.infrastructure.util.ProfileUtil;
+
+import org.springframework.beans.factory.annotation.Autowired;
+import org.springframework.stereotype.Component;
+import org.springframework.web.servlet.HandlerInterceptor;
+
+import jakarta.servlet.http.HttpServletRequest;
+import jakarta.servlet.http.HttpServletResponse;
+import lombok.extern.slf4j.Slf4j;
+
+@Component
+@Slf4j
+public class ProfileInterceptor implements HandlerInterceptor {
+
+    @Autowired
+    private JwtUtil jwtUtil;
+
+    @Override
+    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
+        Object userIdObj = request.getAttribute(USER_ID);
+        Long userId = (userIdObj instanceof Long) ? (Long) userIdObj : null;
+
+        Object usernameObj = request.getAttribute(USERNAME);
+        String username = (usernameObj instanceof String) ? (String) usernameObj : null;
+
+        String host = getRemoteHost(request);
+        log.info("request header username:{}", username);
+        ProfileUtil.put(USER_ID, String.valueOf(userId));
+        ProfileUtil.put(USERNAME, username);
+        ProfileUtil.put(HOST, host);
+        return true;
+    }
+
+    private String getRemoteHost(HttpServletRequest request) {
+        return request.getRemoteHost();
+    }
+
+    @Override
+    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)  {
+        ProfileUtil.remove();
+    }
+
+}
Index: frontend/src/App.jsx
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/frontend/src/App.jsx b/frontend/src/App.jsx
--- a/frontend/src/App.jsx	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ b/frontend/src/App.jsx	(date 1764744784047)
@@ -20,36 +20,59 @@
     // 检查用户是否已登录
     const checkUserAuth = async () => {
       try {
+        console.log('App.jsx: Starting authentication check...')
+        
         // 首先检查localStorage中是否有用户信息
         const storedUser = localStorage.getItem('user')
+        const storedToken = localStorage.getItem('token')
+        
+        console.log('App.jsx: storedUser in localStorage:', storedUser ? 'PRESENT' : 'MISSING')
+        console.log('App.jsx: storedToken in localStorage:', storedToken ? 'PRESENT' : 'MISSING')
+        
         if (storedUser) {
           try {
             const userData = JSON.parse(storedUser)
-            setUser(userData)
-            setLoading(false)
-            return
+            console.log('App.jsx: Parsed user data:', userData)
+            
+            // 如果有用户信息但没有token，清除用户信息并重新检查
+            if (!storedToken) {
+              console.log('App.jsx: User exists but token is missing, clearing user data')
+              localStorage.removeItem('user')
+            } else {
+              // 用户信息和token都存在，设置用户状态
+              setUser(userData)
+              setLoading(false)
+              console.log('App.jsx: User set from localStorage, skipping checkAuth')
+              return
+            }
           } catch (e) {
-            console.error('Error parsing stored user:', e)
+            console.error('App.jsx: Error parsing stored user:', e)
             localStorage.removeItem('user')
           }
         }
         
+        console.log('App.jsx: Calling checkAuth API...')
         // 如果没有本地存储的用户信息，则调用API检查认证状态
         const userData = await checkAuth()
+        console.log('App.jsx: checkAuth returned:', userData)
+        
         if (userData) {
           setUser(userData)
-          // 如果是 OAuth2 用户，确保用户信息被存储
+          // 确保用户信息被存储
           if (!localStorage.getItem('user')) {
             localStorage.setItem('user', JSON.stringify(userData))
+            console.log('App.jsx: User info stored in localStorage')
           }
         } else {
           setUser(null)
+          console.log('App.jsx: No user data from checkAuth, setting user to null')
         }
       } catch (error) {
-        console.error('Error checking auth:', error)
+        console.error('App.jsx: Error checking auth:', error)
         setUser(null)
       } finally {
         setLoading(false)
+        console.log('App.jsx: Authentication check completed')
       }
     }
 
Index: backend/interface/src/main/resources/application.properties
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/interface/src/main/resources/application.properties b/backend/interface/src/main/resources/application.properties
--- a/backend/interface/src/main/resources/application.properties	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ b/backend/interface/src/main/resources/application.properties	(date 1764751200797)
@@ -33,9 +33,14 @@
 spring.h2.console.settings.web-allow-others=false
 
 # Logging
-logging.level.com.personal.portfolio=DEBUG
+logging.level.com.personal.portfolio=TRACE
 logging.level.com.baomidou.mybatisplus=DEBUG
-logging.level.org.springframework.web=INFO
+logging.level.org.springframework.web=DEBUG
+logging.level.org.springframework.security=DEBUG
+logging.level.org.springframework.security.oauth2=DEBUG
+logging.level.org.springframework.security.oauth2.client=DEBUG
+logging.level.org.springframework.security.oauth2.core=DEBUG
+logging.level.org.springframework.security.oauth2.server.resource=DEBUG
 
 # Jackson Date Format Configuration
 spring.jackson.date-format=com.fasterxml.jackson.databind.util.StdDateFormat
@@ -53,3 +58,12 @@
 spring.security.oauth2.client.provider.github.token-uri=https://github.com/login/oauth/access_token
 spring.security.oauth2.client.provider.github.user-info-uri=https://api.github.com/user
 spring.security.oauth2.client.provider.github.user-name-attribute=login
+
+# OAuth2 HTTP Client Configuration - Increased timeouts for slow networks
+# Connection timeout in milliseconds (default is often 10-30 seconds)
+spring.security.oauth2.client.provider.github.connect-timeout=60000
+spring.security.oauth2.client.provider.github.read-timeout=60000
+spring.security.oauth2.client.provider.github.connection-request-timeout=60000
+
+# General HTTP client settings
+spring.mvc.async.request-timeout=60000
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2SuccessHandler.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2SuccessHandler.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2SuccessHandler.java
new file mode 100644
--- /dev/null	(date 1764748852358)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2SuccessHandler.java	(date 1764748852358)
@@ -0,0 +1,134 @@
+package com.personal.portfolio.blog.infrastructure.config;
+
+import com.personal.portfolio.blog.infrastructure.util.JwtUtil;
+
+import org.springframework.security.core.Authentication;
+import org.springframework.security.oauth2.core.user.OAuth2User;
+import org.springframework.security.web.authentication.AuthenticationSuccessHandler;
+import org.springframework.stereotype.Component;
+
+import java.io.IOException;
+import java.util.HashMap;
+import java.util.Map;
+
+import jakarta.servlet.ServletException;
+import jakarta.servlet.http.HttpServletRequest;
+import jakarta.servlet.http.HttpServletResponse;
+import lombok.RequiredArgsConstructor;
+import lombok.extern.slf4j.Slf4j;
+
+/**
+ * OAuth2 登录成功处理器
+ * 处理 GitHub 等 OAuth2 登录成功后的逻辑
+ */
+@Component
+@RequiredArgsConstructor
+@Slf4j
+public class OAuth2SuccessHandler implements AuthenticationSuccessHandler {
+
+    private final JwtUtil jwtUtil;
+
+    @Override
+    public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, 
+                                      Authentication authentication) throws IOException, ServletException {
+
+        log.info("OAuth2 Success Handler called");
+        log.info("Authentication principal type: " + authentication.getPrincipal().getClass().getName());
+        
+        try {
+            if (authentication.getPrincipal() instanceof OAuth2User) {
+                OAuth2User oauth2User = (OAuth2User) authentication.getPrincipal();
+                
+                log.info("OAuth2 User attributes: " + oauth2User.getAttributes());
+                
+                // 从 OAuth2 用户信息中提取必要字段
+                String username = oauth2User.getAttribute("login");
+                String name = oauth2User.getAttribute("name");
+                String email = oauth2User.getAttribute("email");
+                String avatarUrl = oauth2User.getAttribute("avatar_url");
+                
+                log.info("Extracted user info - username: " + username + ", name: " + name + ", email: " + email);
+                
+                // 使用 GitHub ID 作为用户ID，如果没有则使用 username 的哈希值
+                Long userId = null;
+                Object idAttribute = oauth2User.getAttribute("id");
+                if (idAttribute instanceof Integer) {
+                    userId = ((Integer) idAttribute).longValue();
+                } else if (idAttribute instanceof Long) {
+                    userId = (Long) idAttribute;
+                } else if (idAttribute != null) {
+                    // 尝试转换为Long
+                    try {
+                        userId = Long.valueOf(idAttribute.toString());
+                    } catch (NumberFormatException e) {
+                        log.error("Failed to parse user ID: " + idAttribute);
+                    }
+                }
+                
+                if (userId == null) {
+                    userId = (long) Math.abs(username.hashCode());
+                }
+                
+                log.info("User ID: " + userId);
+                
+                // 生成 JWT Token
+                String token = jwtUtil.generateToken(username, userId);
+                log.info("Generated JWT Token: " + token);
+                
+                // 确保用户名不为空
+                if (username == null || username.trim().isEmpty()) {
+                    throw new IllegalArgumentException("GitHub用户名不能为空");
+                }
+                
+                // 构建用户信息，确保所有字段都有值
+                Map<String, Object> userInfo = new HashMap<>();
+                userInfo.put("id", userId != null ? userId : 0L);
+                userInfo.put("username", username != null ? username : "github_user");
+                userInfo.put("login", username != null ? username : "github_user");
+                userInfo.put("name", name != null ? name : username);
+                userInfo.put("email", email != null ? email : "");
+                userInfo.put("avatar_url", avatarUrl != null ? avatarUrl : "");
+                userInfo.put("displayName", name != null ? name : username);
+                
+                // 构建响应数据
+                Map<String, Object> responseData = new HashMap<>();
+                responseData.put("success", true);
+                responseData.put("message", "GitHub 登录成功");
+                responseData.put("token", token);
+                responseData.put("user", userInfo);
+                
+                log.info("Final user info: " + userInfo);
+                
+                // 重定向到前端 OAuth2 成功页面，携带 Token 和用户信息
+                try {
+                    String userInfoJson = new com.fasterxml.jackson.databind.ObjectMapper().writeValueAsString(userInfo);
+                    String redirectUrl = String.format(
+                        "http://localhost:3001/oauth2/success?token=%s&user=%s",
+                        java.net.URLEncoder.encode(token, "UTF-8"),
+                        java.net.URLEncoder.encode(userInfoJson, "UTF-8")
+                    );
+                    
+                    log.info("Redirecting to: " + redirectUrl);
+                    response.sendRedirect(redirectUrl);
+                } catch (Exception jsonError) {
+                    log.error("JSON encoding error: " + jsonError.getMessage());
+                    // 使用更简单的重定向作为备用方案
+                    String redirectUrl = String.format(
+                        "http://localhost:3001/oauth2/success?token=%s",
+                        java.net.URLEncoder.encode(token, "UTF-8")
+                    );
+                    response.sendRedirect(redirectUrl);
+                }
+            } else {
+                // 如果不是 OAuth2 用户，重定向到主页
+                log.info("Not an OAuth2 user, redirecting to home");
+                response.sendRedirect("http://localhost:3001/home");
+            }
+        } catch (Exception e) {
+            log.error("Error in OAuth2 success handler: " + e.getMessage());
+            e.printStackTrace();
+            // 发生错误时重定向到登录页面
+            response.sendRedirect("http://localhost:3001/login?error=oauth2_failed");
+        }
+    }
+}
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java
new file mode 100644
--- /dev/null	(date 1764750483117)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/SecurityConfig.java	(date 1764750483117)
@@ -0,0 +1,106 @@
+package com.personal.portfolio.blog.infrastructure.config;
+
+import com.personal.portfolio.blog.infrastructure.filter.JwtAuthenticationFilter;
+
+import lombok.RequiredArgsConstructor;
+import org.springframework.context.annotation.Bean;
+import org.springframework.context.annotation.Configuration;
+import org.springframework.security.config.annotation.web.builders.HttpSecurity;
+import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
+import org.springframework.security.config.http.SessionCreationPolicy;
+import org.springframework.security.web.SecurityFilterChain;
+import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
+
+import jakarta.servlet.http.Cookie;
+
+/**
+ * Spring Security 配置类
+ */
+@Configuration
+@EnableWebSecurity
+@RequiredArgsConstructor
+public class SecurityConfig {
+
+    private final JwtAuthenticationFilter jwtAuthenticationFilter;
+    private final OAuth2SuccessHandler oauth2SuccessHandler;
+    private final OAuth2FailureHandler oauth2FailureHandler;
+
+    @Bean
+    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
+        http
+            // 配置 CORS
+            .cors(cors -> cors.configurationSource(request -> {
+                org.springframework.web.cors.CorsConfiguration corsConfiguration = new org.springframework.web.cors.CorsConfiguration();
+                corsConfiguration.setAllowedOriginPatterns(java.util.Arrays.asList("http://localhost:3000", "http://localhost:3001", "http://localhost:3002"));
+                corsConfiguration.setAllowedMethods(java.util.Arrays.asList("GET", "POST", "PUT", "DELETE", "OPTIONS"));
+                corsConfiguration.setAllowedHeaders(java.util.Arrays.asList("*"));
+                corsConfiguration.setAllowCredentials(true);
+                return corsConfiguration;
+            }))
+            // 配置会话管理为有状态（OAuth2 需要会话）
+            .sessionManagement(session -> session
+                .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)
+            )
+            .authorizeHttpRequests(authorize -> authorize
+                // 允许公开访问的端点
+                .requestMatchers("/", "/login", "/login/oauth2/**", "/oauth2/**", "/blog/**", "/h2-console/**", 
+                               "/api/logout", "/api/register", "/api/login", 
+                               "/api/check-username", "/api/check-email").permitAll()
+                // 其他请求需要认证
+                .anyRequest().authenticated()
+            )
+            // 禁用表单登录（使用 JWT），但保留 OAuth2 登录
+            .formLogin(form -> form.disable())
+            .oauth2Login(oauth2 -> oauth2
+                .loginPage("/login")
+                .successHandler(oauth2SuccessHandler)
+                .failureHandler(oauth2FailureHandler)
+            )
+            .logout(logout -> logout
+                .logoutUrl("/api/logout")
+                .logoutSuccessUrl("http://localhost:3001/")
+                .invalidateHttpSession(true)
+                .clearAuthentication(true)
+                .deleteCookies("JSESSIONID", "grafana_session", "grafana_session_expiry")
+                .addLogoutHandler((request, response, authentication) -> {
+                    Cookie[] cookies = request.getCookies();
+                    if (cookies != null) {
+                        for (Cookie cookie : cookies) {
+                            if (cookie.getName().equals("JSESSIONID")) {
+                                // 清除 Path=/ 的 JSESSIONID
+                                Cookie clearCookieRoot = new Cookie("JSESSIONID", "");
+                                clearCookieRoot.setPath("/");
+                                clearCookieRoot.setMaxAge(0);
+                                clearCookieRoot.setHttpOnly(cookie.isHttpOnly());
+                                response.addCookie(clearCookieRoot);
+
+                                // 清除 Path=/api 的 JSESSIONID
+                                Cookie clearCookieApi = new Cookie("JSESSIONID", "");
+                                clearCookieApi.setPath("/api");
+                                clearCookieApi.setMaxAge(0);
+                                clearCookieApi.setHttpOnly(cookie.isHttpOnly());
+                                response.addCookie(clearCookieApi);
+                            }
+                            if (cookie.getName().equals("grafana_session") || cookie.getName().equals("grafana_session_expiry")) {
+                                Cookie clearCookie = new Cookie(cookie.getName(), "");
+                                clearCookie.setPath("/");
+                                clearCookie.setMaxAge(0);
+                                clearCookie.setHttpOnly(cookie.isHttpOnly());
+                                response.addCookie(clearCookie);
+                            }
+                        }
+                    }
+                })
+                .permitAll()
+            )
+            // 禁用CSRF保护以便于开发（生产环境应该启用）
+            .csrf().disable()
+            // 允许H2控制台访问
+            .headers().frameOptions().disable();
+
+        // 添加 JWT 认证过滤器
+        http.addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);
+
+        return http.build();
+    }
+}
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2FailureHandler.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2FailureHandler.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2FailureHandler.java
new file mode 100644
--- /dev/null	(date 1764751334475)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/OAuth2FailureHandler.java	(date 1764751334475)
@@ -0,0 +1,121 @@
+package com.personal.portfolio.blog.infrastructure.config;
+
+import jakarta.servlet.ServletException;
+import jakarta.servlet.http.HttpServletRequest;
+import jakarta.servlet.http.HttpServletResponse;
+import lombok.extern.slf4j.Slf4j;
+import org.springframework.security.core.AuthenticationException;
+import org.springframework.security.oauth2.core.OAuth2AuthenticationException;
+import org.springframework.security.oauth2.core.OAuth2Error;
+import org.springframework.security.web.authentication.AuthenticationFailureHandler;
+import org.springframework.stereotype.Component;
+
+import java.io.IOException;
+import java.net.URLEncoder;
+import java.nio.charset.StandardCharsets;
+
+/**
+ * OAuth2 认证失败处理器
+ * 处理 GitHub 等 OAuth2 登录失败后的逻辑，记录详细的错误信息
+ */
+@Component
+@Slf4j
+public class OAuth2FailureHandler implements AuthenticationFailureHandler {
+
+    @Override
+    public void onAuthenticationFailure(HttpServletRequest request, 
+                                      HttpServletResponse response, 
+                                      AuthenticationException exception) throws IOException, ServletException {
+        
+        // 记录关键错误信息
+        log.error("OAuth2 authentication failed for request: {} {} from {}", 
+                 request.getMethod(), request.getRequestURL(), request.getRemoteAddr());
+        
+        // 记录异常信息
+        log.error("Exception: {} - {}", exception.getClass().getSimpleName(), exception.getMessage());
+        
+        // 如果是 OAuth2 异常，记录错误代码
+        if (exception instanceof OAuth2AuthenticationException) {
+            OAuth2AuthenticationException oauth2Ex = (OAuth2AuthenticationException) exception;
+            OAuth2Error error = oauth2Ex.getError();
+            log.error("OAuth2 error code: {}", error.getErrorCode());
+        }
+        
+        // 提取具体的错误信息
+        String errorMessage = extractErrorMessage(exception);
+        String errorDetails = extractErrorDetails(exception);
+        
+        // 重定向到前端错误页面，携带错误信息
+        try {
+            String redirectUrl = String.format(
+                "http://localhost:3001/login?error=true&message=%s&details=%s",
+                URLEncoder.encode(errorMessage, StandardCharsets.UTF_8.name()),
+                URLEncoder.encode(errorDetails, StandardCharsets.UTF_8.name())
+            );
+            
+            response.sendRedirect(redirectUrl);
+        } catch (Exception e) {
+            log.error("Failed to redirect: {}", e.getMessage());
+            // 备用重定向方案
+            response.sendRedirect("http://localhost:3001/login?error=true");
+        }
+    }
+    
+    private String extractErrorMessage(AuthenticationException exception) {
+        if (exception instanceof OAuth2AuthenticationException) {
+            OAuth2AuthenticationException oauth2Ex = (OAuth2AuthenticationException) exception;
+            OAuth2Error error = oauth2Ex.getError();
+            
+            // 根据错误代码提供友好的错误信息
+            String errorCode = error.getErrorCode();
+            switch (errorCode) {
+                case "invalid_client":
+                    return "GitHub OAuth2 客户端配置错误（Client ID 或 Client Secret 无效）";
+                case "invalid_request":
+                    return "无效的 OAuth2 请求";
+                case "unauthorized_client":
+                    return "客户端未授权使用此授权类型";
+                case "access_denied":
+                    return "用户拒绝了授权请求";
+                case "unsupported_response_type":
+                    return "不支持的响应类型";
+                case "invalid_scope":
+                    return "请求的范围无效或未知";
+                case "server_error":
+                    return "GitHub 服务器错误";
+                case "temporarily_unavailable":
+                    return "GitHub 服务暂时不可用";
+                case "redirect_uri_mismatch":
+                    return "回调 URL 不匹配，请检查 GitHub 应用配置";
+                default:
+                    return "OAuth2 错误: " + errorCode;
+            }
+        }
+        
+        // 其他类型的异常
+        return exception.getMessage() != null ? 
+               exception.getMessage() : "未知的认证错误";
+    }
+    
+    private String extractErrorDetails(AuthenticationException exception) {
+        StringBuilder details = new StringBuilder();
+        
+        details.append("异常类型: ").append(exception.getClass().getName()).append("\n");
+        details.append("异常消息: ").append(exception.getMessage()).append("\n");
+        
+        if (exception instanceof OAuth2AuthenticationException) {
+            OAuth2AuthenticationException oauth2Ex = (OAuth2AuthenticationException) exception;
+            OAuth2Error error = oauth2Ex.getError();
+            details.append("OAuth2 错误代码: ").append(error.getErrorCode()).append("\n");
+            details.append("OAuth2 错误描述: ").append(error.getDescription()).append("\n");
+            if (error.getUri() != null) {
+                details.append("OAuth2 错误 URI: ").append(error.getUri()).append("\n");
+            }
+        }
+        
+        // 添加时间戳
+        details.append("发生时间: ").append(java.time.LocalDateTime.now()).append("\n");
+        
+        return details.toString();
+    }
+}
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/filter/JwtAuthenticationFilter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/filter/JwtAuthenticationFilter.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/filter/JwtAuthenticationFilter.java
new file mode 100644
--- /dev/null	(date 1764669802777)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/filter/JwtAuthenticationFilter.java	(date 1764669802777)
@@ -0,0 +1,101 @@
+package com.personal.portfolio.blog.infrastructure.filter;
+
+import static com.personal.portfolio.blog.infrastructure.context.ContextConstants.USER_ID;
+import static com.personal.portfolio.blog.infrastructure.context.ContextConstants.USERNAME;
+
+import com.personal.portfolio.blog.infrastructure.util.JwtUtil;
+import jakarta.servlet.FilterChain;
+import jakarta.servlet.ServletException;
+import jakarta.servlet.http.HttpServletRequest;
+import jakarta.servlet.http.HttpServletResponse;
+import lombok.RequiredArgsConstructor;
+import lombok.extern.slf4j.Slf4j;
+import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
+import org.springframework.security.core.authority.SimpleGrantedAuthority;
+import org.springframework.security.core.context.SecurityContextHolder;
+import org.springframework.stereotype.Component;
+import org.springframework.web.filter.OncePerRequestFilter;
+
+import java.io.IOException;
+import java.util.Collections;
+import java.util.Enumeration;
+
+/**
+ * JWT 认证过滤器
+ */
+@Slf4j
+@Component
+@RequiredArgsConstructor
+public class JwtAuthenticationFilter extends OncePerRequestFilter {
+
+    private final JwtUtil jwtUtil;
+
+    @Override
+    protected void doFilterInternal(HttpServletRequest request, 
+                                  HttpServletResponse response, 
+                                  FilterChain filterChain) throws ServletException, IOException {
+        
+        String requestUri = request.getRequestURI();
+        String method = request.getMethod();
+        
+        log.debug("JWT Filter processing {} request to {}", method, requestUri);
+        
+        // 记录请求头信息（调试用）
+        if (log.isDebugEnabled()) {
+            Enumeration<String> headerNames = request.getHeaderNames();
+            while (headerNames.hasMoreElements()) {
+                String headerName = headerNames.nextElement();
+                if (headerName.equalsIgnoreCase("authorization")) {
+                    log.debug("Request header {}: {}", headerName, request.getHeader(headerName));
+                }
+            }
+        }
+        
+        // 获取请求头中的 Token
+        String token = jwtUtil.resolveToken(request);
+        
+        log.debug("Resolved token from request: {}", token != null ? "[PRESENT]" : "null");
+        
+        if (token != null) {
+            log.debug("Token found, validating...");
+            boolean isValid = jwtUtil.validateToken(token);
+            log.debug("Token validation result: {}", isValid);
+            
+            if (isValid) {
+                // Token 有效，设置认证信息
+                String username = jwtUtil.getUsernameFromToken(token);
+                Long userId = jwtUtil.getUserIdFromToken(token);
+                
+                log.debug("Token decoded - username: {}, userId: {}", username, userId);
+                
+                if (username != null && userId != null) {
+                    // 创建认证令牌
+                    UsernamePasswordAuthenticationToken authentication = 
+                        new UsernamePasswordAuthenticationToken(
+                            username, 
+                            null, 
+                            Collections.singletonList(new SimpleGrantedAuthority("ROLE_USER"))
+                        );
+                    
+                    // 设置认证信息到 SecurityContext
+                    SecurityContextHolder.getContext().setAuthentication(authentication);
+                    
+                    // 将用户ID设置到请求属性中，方便后续使用
+                    request.setAttribute(USER_ID, userId);
+                    request.setAttribute(USERNAME, username);
+                    
+                    log.debug("Authentication set for user: {}", username);
+                } else {
+                    log.warn("Token validation passed but could not extract username or userId");
+                }
+            } else {
+                log.warn("Invalid JWT token received");
+            }
+        } else {
+            log.debug("No JWT token found in request");
+        }
+        
+        filterChain.doFilter(request, response);
+    }
+
+}
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/WebMvcConfig.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/WebMvcConfig.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/WebMvcConfig.java
new file mode 100644
--- /dev/null	(date 1764646332598)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/WebMvcConfig.java	(date 1764646332598)
@@ -0,0 +1,23 @@
+package com.personal.portfolio.blog.infrastructure.config;
+
+import com.personal.portfolio.blog.infrastructure.interceptor.ProfileInterceptor;
+
+import org.springframework.beans.factory.annotation.Autowired;
+import org.springframework.context.annotation.Configuration;
+import org.springframework.web.servlet.config.annotation.InterceptorRegistry;
+import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
+
+@Configuration
+public class WebMvcConfig implements WebMvcConfigurer {
+
+    @Autowired
+    private ProfileInterceptor profileInterceptor;
+
+    @Override
+    public void addInterceptors(InterceptorRegistry registry) {
+        String patternsAll = "/**";
+
+        registry.addInterceptor(profileInterceptor).addPathPatterns(patternsAll);
+
+    }
+}
Index: backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/JwtProperties.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/JwtProperties.java b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/JwtProperties.java
new file mode 100644
--- /dev/null	(date 1764646332589)
+++ b/backend/infrastructure/src/main/java/com/personal/portfolio/blog/infrastructure/config/JwtProperties.java	(date 1764646332589)
@@ -0,0 +1,34 @@
+package com.personal.portfolio.blog.infrastructure.config;
+
+import lombok.Data;
+import org.springframework.boot.context.properties.ConfigurationProperties;
+import org.springframework.stereotype.Component;
+
+/**
+ * JWT 配置属性
+ */
+@Data
+@Component
+@ConfigurationProperties(prefix = "jwt")
+public class JwtProperties {
+    
+    /**
+     * JWT 密钥
+     */
+    private String secret = "personal-portfolio-jwt-secret-key-2025";
+    
+    /**
+     * Token 过期时间（分钟）
+     */
+    private Long expiration = 120L;
+    
+    /**
+     * Token 前缀
+     */
+    private String tokenPrefix = "Bearer ";
+    
+    /**
+     * Token 请求头名称
+     */
+    private String tokenHeader = "Authorization";
+}
Index: frontend/src/services/authService.js
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/frontend/src/services/authService.js b/frontend/src/services/authService.js
--- a/frontend/src/services/authService.js	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ b/frontend/src/services/authService.js	(date 1764746024266)
@@ -43,7 +43,7 @@
     const token = localStorage.getItem('token')
     
     console.log('checkAuth called, token in localStorage:', token)
-    
+
     // 使用全局拦截器自动添加 token（如果有的话）
     const response = await api.get('/user/profile')
     
@@ -224,20 +224,22 @@
       password
     })
     
-    // 解析嵌套的响应数据结构
-    const responseData = response.data
-    const loginData = responseData.data
+    console.log('Login response:', response.data)
     
-    // 新的响应结构：如果登录成功，直接返回用户数据和token
-    // 不再使用success字段，而是通过HTTP状态码判断
+    // 后端直接返回 LoginResponse 对象，没有嵌套的 data 字段
+    const loginData = response.data.data
+    
+    // 如果登录成功，直接返回用户数据和token
     if (loginData && loginData.token) {
       // 存储 token
       localStorage.setItem('token', loginData.token)
+
       // 存储用户信息
       if (loginData.user) {
         localStorage.setItem('user', JSON.stringify(loginData.user))
       }
-      // 返回实际的登录数据，而不是整个响应
+      
+      // 返回登录数据
       return loginData
     }
     
Index: backend/infrastructure/pom.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/infrastructure/pom.xml b/backend/infrastructure/pom.xml
--- a/backend/infrastructure/pom.xml	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ b/backend/infrastructure/pom.xml	(date 1764646332592)
@@ -48,5 +48,23 @@
             <groupId>com.fasterxml.jackson.datatype</groupId>
             <artifactId>jackson-datatype-jsr310</artifactId>
         </dependency>
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-starter-security</artifactId>
+        </dependency>
+        <dependency>
+            <groupId>com.alibaba</groupId>
+            <artifactId>transmittable-thread-local</artifactId>
+            <version>2.14.5</version>
+        </dependency>
+        <dependency>
+            <groupId>org.springframework.boot</groupId>
+            <artifactId>spring-boot-starter-oauth2-client</artifactId>
+        </dependency>
+        <!-- Hutool -->
+        <dependency>
+            <groupId>cn.hutool</groupId>
+            <artifactId>hutool-all</artifactId>
+        </dependency>
     </dependencies>
 </project>
Index: backend/application/src/main/java/com/personal/portfolio/blog/application/config/DefaultUserInitializer.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/application/src/main/java/com/personal/portfolio/blog/application/config/DefaultUserInitializer.java b/backend/application/src/main/java/com/personal/portfolio/blog/application/config/DefaultUserInitializer.java
new file mode 100644
--- /dev/null	(date 1764752437883)
+++ b/backend/application/src/main/java/com/personal/portfolio/blog/application/config/DefaultUserInitializer.java	(date 1764752437883)
@@ -0,0 +1,55 @@
+package com.personal.portfolio.blog.application.config;
+
+import com.personal.portfolio.blog.application.service.UserRegistrationService;
+import com.personal.portfolio.blog.domain.entity.User;
+import lombok.RequiredArgsConstructor;
+import lombok.extern.slf4j.Slf4j;
+import org.springframework.boot.CommandLineRunner;
+import org.springframework.stereotype.Component;
+
+/**
+ * 默认用户初始化配置
+ * 在应用启动时自动创建默认管理员账号
+ */
+@Component
+@Slf4j
+@RequiredArgsConstructor
+public class DefaultUserInitializer implements CommandLineRunner {
+
+    private final UserRegistrationService userRegistrationService;
+    
+    // 默认用户配置
+    private static final String DEFAULT_USERNAME = "admin";
+    private static final String DEFAULT_PASSWORD = "adminadmin";
+    private static final String DEFAULT_EMAIL = "admin@example.com";
+    
+    @Override
+    public void run(String... args) {
+        try {
+            log.info("开始检查默认用户...");
+            
+            // 检查默认用户是否已存在
+            if (userRegistrationService.isUsernameAvailable(DEFAULT_USERNAME)) {
+                log.info("默认用户 '{}' 不存在，开始创建...", DEFAULT_USERNAME);
+                
+                // 创建默认用户
+                User defaultUser = userRegistrationService.registerUser(
+                    DEFAULT_USERNAME, 
+                    DEFAULT_PASSWORD, 
+                    DEFAULT_EMAIL
+                );
+                
+                log.info("默认用户创建成功！用户名: {}, 用户ID: {}", 
+                        defaultUser.getUsername(), defaultUser.getId());
+                log.info("默认登录凭证 - 用户名: {}, 密码: {}", DEFAULT_USERNAME, DEFAULT_PASSWORD);
+            } else {
+                log.info("默认用户 '{}' 已存在，跳过创建", DEFAULT_USERNAME);
+            }
+            
+            log.info("默认用户检查完成");
+        } catch (Exception e) {
+            log.error("创建默认用户时发生错误: {}", e.getMessage(), e);
+            // 不抛出异常，避免影响应用启动
+        }
+    }
+}
Index: backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/AuthController.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/AuthController.java b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/AuthController.java
--- a/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/AuthController.java	(revision 2c52e4f690295aa555c1c1a199d54decab2b8464)
+++ b/backend/interface/src/main/java/com/personal/portfolio/blog/interfaces/controller/AuthController.java	(date 1764748614279)
@@ -2,11 +2,12 @@
 
 import com.personal.portfolio.blog.application.service.UserRegistrationService;
 import com.personal.portfolio.blog.domain.entity.User;
+import com.personal.portfolio.blog.domain.repository.UserRepository;
 import com.personal.portfolio.blog.interfaces.dto.request.LoginRequest;
 import com.personal.portfolio.blog.interfaces.dto.request.RegisterRequest;
 import com.personal.portfolio.blog.interfaces.dto.response.*;
 import com.personal.portfolio.blog.interfaces.exception.InvalidCredentialsException;
-import com.personal.portfolio.blog.interfaces.util.JwtUtil;
+import com.personal.portfolio.blog.infrastructure.util.JwtUtil;
 import org.springframework.security.core.Authentication;
 import org.springframework.security.core.annotation.AuthenticationPrincipal;
 import org.springframework.security.core.context.SecurityContextHolder;
@@ -18,19 +19,23 @@
 import jakarta.servlet.http.HttpServletRequest;
 import jakarta.servlet.http.HttpServletResponse;
 import jakarta.servlet.http.HttpSession;
+import lombok.extern.slf4j.Slf4j;
 
 /**
  * 认证控制器
  */
 @Controller
+@Slf4j
 public class AuthController {
 
     private final UserRegistrationService userRegistrationService;
     private final JwtUtil jwtUtil;
+    private final UserRepository userRepository;
 
-    public AuthController(UserRegistrationService userRegistrationService, JwtUtil jwtUtil) {
+    public AuthController(UserRegistrationService userRegistrationService, JwtUtil jwtUtil, UserRepository userRepository) {
         this.userRegistrationService = userRegistrationService;
         this.jwtUtil = jwtUtil;
+        this.userRepository = userRepository;
     }
 
     /**
@@ -46,16 +51,17 @@
      */
     @GetMapping("/user/profile")
     @ResponseBody
-    public UserProfileResponse getUserProfile(@AuthenticationPrincipal Object principal) {
+    public UserProfileResponse getUserProfile(@AuthenticationPrincipal Object principal,
+                                            HttpServletRequest request) {
         UserProfileResponse userInfo = new UserProfileResponse();
         
-        System.out.println("getUserProfile called, principal type: " + (principal != null ? principal.getClass().getName() : "null"));
+        log.info("getUserProfile called, principal type: " + (principal != null ? principal.getClass().getName() : "null"));
         
         if (principal != null) {
             // 处理 OAuth2 用户
             if (principal instanceof OAuth2User) {
                 OAuth2User oauth2User = (OAuth2User) principal;
-                System.out.println("OAuth2 User attributes: " + oauth2User.getAttributes());
+                log.info("OAuth2 User attributes: " + oauth2User.getAttributes());
                 
                 userInfo.setId(oauth2User.getAttribute("id") != null ? oauth2User.getAttribute("id").toString() : null);
                 userInfo.setLogin(oauth2User.getAttribute("login"));
@@ -74,23 +80,48 @@
                 userInfo.setCreatedAt(oauth2User.getAttribute("created_at"));
                 userInfo.setUpdatedAt(oauth2User.getAttribute("updated_at"));
             } 
-            // 处理本地用户（从 Spring Security 上下文获取）
+            // 处理本地用户（JWT 认证）
             else {
-                Authentication authentication =
-                    SecurityContextHolder.getContext().getAuthentication();
-                System.out.println("Authentication: " + authentication);
-                System.out.println("Is authenticated: " + (authentication != null ? authentication.isAuthenticated() : "null"));
+                Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
+                log.info("Authentication: " + authentication);
+                log.info("Principal class: " + (authentication != null && authentication.getPrincipal() != null ? 
+                    authentication.getPrincipal().getClass().getName() : "null"));
+                log.info("Is authenticated: " + (authentication != null ? authentication.isAuthenticated() : "null"));
                 
-                if (authentication != null && authentication.isAuthenticated() && 
-                    !(authentication.getPrincipal() instanceof String)) {
-                    
-                    // 这里假设认证主体包含用户信息，实际需要根据你的认证配置调整
+                if (authentication != null && authentication.isAuthenticated()) {
                     String username = authentication.getName();
-                    userInfo.setLogin(username);
-                    userInfo.setUsername(username);
-                    userInfo.setName(username);
-                    userInfo.setAvatarUrl("https://via.placeholder.com/35x35/667eea/ffffff?text=" + 
-                        username.substring(0, 1).toUpperCase());
+                    log.info("Username from authentication: " + username);
+                    
+                    // 从请求属性中获取用户ID（由 JWT 过滤器设置）
+                    Long userId = (Long) request.getAttribute("USER_ID");
+                    log.info("User ID from request attribute: " + userId);
+                    
+                    if (username != null && !username.equals("anonymousUser")) {
+                        userInfo.setId(userId != null ? userId.toString() : null);
+                        userInfo.setLogin(username);
+                        userInfo.setUsername(username);
+                        userInfo.setName(username);
+                        userInfo.setAvatarUrl("https://via.placeholder.com/35x35/667eea/ffffff?text=" + 
+                            username.substring(0, 1).toUpperCase());
+                        
+                        // 尝试从数据库获取更多用户信息
+                        try {
+                            // 直接使用 UserRepository 查找用户
+                            User user = userRepository.findByUsername(username).orElse(null);
+                            if (user != null) {
+                                userInfo.setEmail(user.getEmail());
+                                userInfo.setBio(user.getBio());
+                                // 确保 ID 正确设置（优先使用数据库中的 ID）
+                                if (user.getId() != null) {
+                                    userInfo.setId(user.getId().toString());
+                                }
+                            }
+                        } catch (Exception e) {
+                            log.info("Could not fetch user details from database: " + e.getMessage());
+                        }
+                    } else {
+                        userInfo.setError("用户未登录或匿名用户");
+                    }
                 } else {
                     userInfo.setError("用户未登录");
                 }
@@ -99,7 +130,7 @@
             userInfo.setError("用户未登录");
         }
         
-        System.out.println("Returning user info: " + userInfo);
+        log.info("Returning user info: " + userInfo);
         return userInfo;
     }
 
@@ -108,8 +139,9 @@
      */
     @GetMapping("/api/user/profile")
     @ResponseBody
-    public UserProfileResponse getApiUserProfile(@AuthenticationPrincipal Object principal) {
-        return getUserProfile(principal);
+    public UserProfileResponse getApiUserProfile(@AuthenticationPrincipal Object principal,
+                                               HttpServletRequest request) {
+        return getUserProfile(principal, request);
     }
 
     /**
